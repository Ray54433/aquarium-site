import{C as t,u as e,g as a,t as l,M as s,N as r,j as i,O as c,p as n,n as u,l as o,q as d,B as f,r as h,y as p,z as _,x as g,A as m,D as b,c as y,w as F,i as C,o as k,a as w,b as P,L as v,E as D,F as S,G as T,H as N,J as $,e as x,S as I,K as M,d as j}from"./index-DeSSVyR4.js";import{r as A,_ as L}from"./uni-app.es._Cs-_V8k.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";const E=B({data:()=>({tradeType:"wts",posts:[],currentFilter:"all",currentSubFilter:"all",currentDetailFilter:"all",isMod:!1}),computed:{subCategories(){if("all"===this.currentFilter)return[];const e=t.find((t=>t.id===this.currentFilter));return e&&e.children?e.children:[]},detailCategories(){if("all"===this.currentSubFilter)return[];const t=this.subCategories.find((t=>t.id===this.currentSubFilter));return t&&t.children?t.children:[]},tradePosts(){let t=this.posts.filter((t=>t.type===this.tradeType));return"all"!==this.currentFilter&&(t=t.filter((t=>t.categoryId===this.currentFilter))),"all"!==this.currentSubFilter&&(t=t.filter((t=>t.subCategoryId===this.currentSubFilter))),"all"!==this.currentDetailFilter&&(t=t.filter((t=>t.detailCategoryId===this.currentDetailFilter))),t}},onShow(){e(),this.checkModStatus(),this.loadPosts()},onPullDownRefresh(){this.loadPosts(),setTimeout((()=>{a()}),1e3)},methods:{checkModStatus(){const t=l();this.isMod=s(t),!t||"ray"!==t.name&&"ray"!==t.username||(this.isMod=!0)},async togglePin(t){const e=!t.isPinned,a=e?"ç½®é ‚":"å–æ¶ˆç½®é ‚";r({title:"ç®¡ç†å“¡æ“ä½œ",content:`ç¢ºå®šè¦${a}æ­¤å¸–å­å—Žï¼Ÿ`,success:async l=>{if(l.confirm)try{i({title:"è™•ç†ä¸­..."}),await c(t.id,{isPinned:e}),t.isPinned=e,this.loadPosts(),n(),u({title:`å·²${a}`})}catch(s){console.error("Pin error:",s),n(),u({title:"æ“ä½œå¤±æ•—",icon:"none"})}}})},loadPosts(){const t=o();this.posts=t.filter((t=>"wtb"===t.type||"wts"===t.type)),this.posts.sort(((t,e)=>t.isPinned&&!e.isPinned?-1:!t.isPinned&&e.isPinned?1:(e.timestamp||0)-(t.timestamp||0)))},setTradeType(t){this.tradeType=t},setFilter(t){this.currentFilter=t,this.currentSubFilter="all",this.currentDetailFilter="all"},setSubFilter(t){this.currentSubFilter=t,this.currentDetailFilter="all"},setDetailFilter(t){this.currentDetailFilter=t},getCategoryEmoji:t=>({saltwater:"ðŸ ",freshwater:"ðŸŸ",plants:"ðŸŒ¿",crystal_shrimp:"ðŸ¦"}[t]||"ðŸ“¦"),getCategoryName:t=>({saltwater:"å’¸æ°´å€",freshwater:"æ·¡æ°´å€",plants:"æ°´è‰å€",crystal_shrimp:"æ°´æ™¶è¦å€"}[t]||t),goToDetail(t){d({url:`/pages/detail/detail?id=${t}`})},createTradePost(){if(!f("currentUser"))return u({title:"è«‹å…ˆç™»å…¥",icon:"none"}),void setTimeout((()=>{d({url:"/pages/login/login"})}),1e3);let t=`/pages/create/create?mode=trade&type=${this.tradeType}`;"all"!==this.currentFilter&&(t+=`&categoryId=${this.currentFilter}`),"all"!==this.currentSubFilter&&(t+=`&subCategoryId=${this.currentSubFilter}`),"all"!==this.currentDetailFilter&&(t+=`&detailCategoryId=${this.currentDetailFilter}`),d({url:t})},formatDate(t){if(!t)return"";const e=new Date(t<1e10?1e3*t:t);return isNaN(e.getTime())?"":`${e.getMonth()+1}/${e.getDate()} ${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`},getLevel(t){let e=t.authorId;if(!e&&t.authorName){const a=h(t.authorName);a&&(e=a.id)}return p(e)},getPoints(t){let e=t.authorId;if(!e&&t.authorName){const a=h(t.authorName);a&&(e=a.id)}return _(e)},getBadges(t){let e=t.authorId;if(!e&&t.authorName){const a=h(t.authorName);a&&(e=a.id)}return g(e)},getAvatar(t){let e=t.authorId;if(!e&&t.authorName){const a=h(t.authorName);a&&(e=a.id)}return t.authorAvatar?t.authorAvatar:m(e)}}},[["render",function(t,e,a,l,s,r){const i=x,c=C,n=I,u=j,o=A(b("app-tab-bar"),L);return k(),y(c,{class:"container"},{default:F((()=>[w(c,{class:"header-section"},{default:F((()=>[w(c,{class:"header-content"},{default:F((()=>[w(i,{class:"page-title"},{default:F((()=>[P("äº¤æ˜“å¸‚å ´ ðŸ¤")])),_:1}),w(i,{class:"page-subtitle"},{default:F((()=>[P("è²·è³£æ°´æ—å™¨æèˆ‡ç”Ÿç‰©")])),_:1})])),_:1})])),_:1}),w(c,{class:"notice-bar-container"},{default:F((()=>[w(c,{class:"notice-bar"},{default:F((()=>[w(i,{class:"notice-text"},{default:F((()=>[P("ðŸ“¢ æ‹è³£ç‰ˆè¦ï¼š1. åš´ç¦ç™¼ä½ˆè™›å‡å•†å“ã€‚ 2. ç¦æ­¢å”®è³£å—ä¿è­·ç€•å±ç‰©ç¨®ã€‚ 3. è²·è³£é›™æ–¹è«‹è‡ªè¡Œæ‰¿æ“”é¢¨éšªï¼Œæœ¬å¹³å°ä¸ä»‹å…¥ç³¾ç´›ã€‚ 4. åš´ç¦æ£„æ¨™ï¼Œé•è€…å°‡è¢«åˆ—å…¥é»‘åå–®ã€‚ 5. è«‹æ¨™æ˜Žæ¸…æ¥šåƒ¹éŒ¢åŠäº¤æ”¶åœ°é»žã€‚ âš ï¸")])),_:1})])),_:1})])),_:1}),w(c,{class:"content-area"},{default:F((()=>[w(c,{class:"trade-tabs-card"},{default:F((()=>[w(c,{class:v(["tab-item",{active:"wtb"===s.tradeType}]),onClick:e[0]||(e[0]=t=>r.setTradeType("wtb"))},{default:F((()=>[w(i,{class:"tab-icon"},{default:F((()=>[P("ðŸ”")])),_:1}),w(i,{class:"tab-text"},{default:F((()=>[P("å¾µæ±‚ (è²·)")])),_:1})])),_:1},8,["class"]),w(c,{class:v(["tab-item",{active:"wts"===s.tradeType}]),onClick:e[1]||(e[1]=t=>r.setTradeType("wts"))},{default:F((()=>[w(i,{class:"tab-icon"},{default:F((()=>[P("ðŸ’°")])),_:1}),w(i,{class:"tab-text"},{default:F((()=>[P("å‡ºå”® (è³£)")])),_:1})])),_:1},8,["class"])])),_:1}),w(c,{class:"filter-section"},{default:F((()=>[w(n,{"scroll-x":"true",class:"filter-scroll","show-scrollbar":"false"},{default:F((()=>[w(c,{class:"filter-group"},{default:F((()=>[w(c,{class:v(["filter-chip",{active:"all"===s.currentFilter}]),onClick:e[2]||(e[2]=t=>r.setFilter("all"))},{default:F((()=>[w(i,null,{default:F((()=>[P("å…¨éƒ¨")])),_:1})])),_:1},8,["class"]),(k(),D(T,null,S(["crystal_shrimp","plants","freshwater","saltwater"],(t=>w(c,{class:v(["filter-chip",{active:s.currentFilter===t}]),key:t,onClick:e=>r.setFilter(t)},{default:F((()=>[w(i,null,{default:F((()=>[P($(r.getCategoryEmoji(t))+" "+$(r.getCategoryName(t)),1)])),_:2},1024)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),r.subCategories.length>0?(k(),y(n,{key:0,"scroll-x":"true",class:"filter-scroll sub-filter","show-scrollbar":"false"},{default:F((()=>[w(c,{class:"filter-group"},{default:F((()=>[w(c,{class:v(["filter-chip sub-chip",{active:"all"===s.currentSubFilter}]),onClick:e[3]||(e[3]=t=>r.setSubFilter("all"))},{default:F((()=>[w(i,null,{default:F((()=>[P("å…¨éƒ¨")])),_:1})])),_:1},8,["class"]),(k(!0),D(T,null,S(r.subCategories,(t=>(k(),y(c,{class:v(["filter-chip sub-chip",{active:s.currentSubFilter===t.id}]),key:t.id,onClick:e=>r.setSubFilter(t.id)},{default:F((()=>[w(i,null,{default:F((()=>[P($(t.icon)+" "+$(t.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})):N("",!0),r.detailCategories.length>0?(k(),y(n,{key:1,"scroll-x":"true",class:"filter-scroll detail-filter","show-scrollbar":"false"},{default:F((()=>[w(c,{class:"filter-group"},{default:F((()=>[w(c,{class:v(["filter-chip detail-chip",{active:"all"===s.currentDetailFilter}]),onClick:e[4]||(e[4]=t=>r.setDetailFilter("all"))},{default:F((()=>[w(i,null,{default:F((()=>[P("å…¨éƒ¨")])),_:1})])),_:1},8,["class"]),(k(!0),D(T,null,S(r.detailCategories,(t=>(k(),y(c,{class:v(["filter-chip detail-chip",{active:s.currentDetailFilter===t.id}]),key:t.id,onClick:e=>r.setDetailFilter(t.id)},{default:F((()=>[w(i,null,{default:F((()=>[P($(t.icon)+" "+$(t.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1})):N("",!0)])),_:1}),w(c,{class:"post-list"},{default:F((()=>[(k(!0),D(T,null,S(r.tradePosts,((t,e)=>(k(),y(c,{key:e,class:"post-card",onClick:e=>r.goToDetail(t.id)},{default:F((()=>[w(c,{class:"card-header"},{default:F((()=>[w(c,{class:"author-info"},{default:F((()=>[w(u,{src:r.getAvatar(t)||"/static/logo.png",class:"post-list-avatar",mode:"aspectFill"},null,8,["src"]),w(c,{class:"author-meta"},{default:F((()=>[w(c,{class:"name-row"},{default:F((()=>[w(i,{class:"author-name"},{default:F((()=>[P($(t.authorName),1)])),_:2},1024),w(c,{class:"user-stats"},{default:F((()=>[w(i,{class:"stat-badge level"},{default:F((()=>[P("Lv."+$(r.getLevel(t)),1)])),_:2},1024),w(i,{class:"stat-badge points"},{default:F((()=>[P("ðŸ”¥"+$(r.getPoints(t)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),w(i,{class:"post-time"},{default:F((()=>[P($(r.formatDate(t.timestamp)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),w(c,{class:"header-right"},{default:F((()=>[t.price?(k(),y(c,{key:0,class:"price-badge"},{default:F((()=>[w(i,null,{default:F((()=>[P($("wtb"===t.type?"é ç®—":"å”®")+" $"+$(t.price),1)])),_:2},1024)])),_:2},1024)):N("",!0),w(c,{class:v(["status-badge",t.type])},{default:F((()=>[w(i,null,{default:F((()=>[P($("wtb"===t.type?"å¾µæ±‚ä¸­":"å‡ºå”®ä¸­"),1)])),_:2},1024)])),_:2},1032,["class"]),t.isPinned?(k(),y(c,{key:1,class:"pin-badge"},{default:F((()=>[w(i,null,{default:F((()=>[P("ðŸ“Œ ç½®é ‚")])),_:1})])),_:1})):N("",!0),s.isMod?(k(),y(c,{key:2,class:"admin-pin-btn",onClick:M((e=>r.togglePin(t)),["stop"])},{default:F((()=>[w(i,null,{default:F((()=>[P($(t.isPinned?"å–æ¶ˆç½®é ‚":"ç½®é ‚"),1)])),_:2},1024)])),_:2},1032,["onClick"])):N("",!0)])),_:2},1024)])),_:2},1024),w(c,{class:"card-content"},{default:F((()=>[w(i,{class:"post-title"},{default:F((()=>[P($(t.title),1)])),_:2},1024),w(i,{class:"post-desc"},{default:F((()=>[P($(t.content.substring(0,60))+"...",1)])),_:2},1024)])),_:2},1024),t.images&&t.images.length>0?(k(),y(c,{key:0,class:"card-images"},{default:F((()=>[(k(!0),D(T,null,S(t.images.slice(0,3),((t,e)=>(k(),y(u,{key:e,src:t,mode:"aspectFill",class:"post-img"},null,8,["src"])))),128))])),_:2},1024)):t.image?(k(),y(u,{key:1,src:t.image,mode:"aspectFill",class:"post-img-single"},null,8,["src"])):N("",!0),w(c,{class:"card-footer"},{default:F((()=>[w(c,{class:"interaction-item"},{default:F((()=>[w(i,{class:"interaction-icon"},{default:F((()=>[P("ðŸ’¬")])),_:1}),w(i,null,{default:F((()=>[P($(t.comments?t.comments.length:0)+" ç•™è¨€",1)])),_:2},1024)])),_:2},1024),w(c,{class:"interaction-item"},{default:F((()=>[w(i,{class:"interaction-icon"},{default:F((()=>[P("ðŸ‘€")])),_:1}),w(i,null,{default:F((()=>[P($(t.views||0)+" ç€è¦½",1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),0===r.tradePosts.length?(k(),y(c,{key:0,class:"empty-state"},{default:F((()=>[w(i,{class:"empty-icon"},{default:F((()=>[P("ðŸ“­")])),_:1}),w(i,{class:"empty-text"},{default:F((()=>[P("æš«ç„¡"+$("wtb"===s.tradeType?"å¾µæ±‚":"å‡ºå”®")+"å¸–å­",1)])),_:1})])),_:1})):N("",!0)])),_:1})])),_:1}),w(o,{selectedBase:1}),w(c,{class:"fab",onClick:r.createTradePost},{default:F((()=>[w(i,{class:"fab-icon"},{default:F((()=>[P("+")])),_:1})])),_:1},8,["onClick"])])),_:1})}],["__scopeId","data-v-3525396f"]]);export{E as default};
