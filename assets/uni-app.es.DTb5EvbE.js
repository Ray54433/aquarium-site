import{al as e,aO as a,a7 as t,aP as s,s as r,aQ as d,t as i,aR as n,X as o,o as c,c as l,w as u,a as p,E as g,G as h,F as f,b,J as m,L as x,H as _,i as B,e as P}from"./index-BurITbpl.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const y=C({name:"app-tab-bar",data:()=>({selected:0,unreadCount:0,list:[{pagePath:"pages/home/home",text:"é¦–é ",icon:"ðŸ "},{pagePath:"pages/market/market",text:"äº¤æ˜“",icon:"ðŸ¤"},{pagePath:"pages/circle/circle",text:"å¹æ°´å»£å ´",icon:"ðŸ—£ï¸"},{pagePath:"pages/message/message",text:"æ¶ˆæ¯",icon:"ðŸ””"},{pagePath:"pages/profile/profile",text:"æˆ‘çš„",icon:"ðŸ‘¤"}]}),props:{selectedBase:{type:Number,default:-1}},mounted(){this.updateSelected(),this.updateBadge(),e("updateMessageBadge",this.updateBadge),a()},beforeDestroy(){t("updateMessageBadge",this.updateBadge)},methods:{updateSelected(){if(-1!==this.selectedBase)return void(this.selected=this.selectedBase);const e=s();if(e.length>0){const a=e[e.length-1].route,t=this.list.findIndex((e=>e.pagePath===a||a.startsWith(e.pagePath)));-1!==t&&(this.selected=t)}},switchTab(e,a){const t="/"+e.pagePath;r({url:t,fail:()=>{d({url:t})}})},async updateBadge(){const e=i();if(!e)return void(this.unreadCount=0);const a=n(e.id).filter((e=>!e.read)).length;let t=0;try{const{data:a}=await o(e.id);a&&(t=a.filter((a=>a.receiverId===e.id&&!1===a.read)).length)}catch(s){console.error("Badge update error:",s)}this.unreadCount=a+t}}},[["render",function(e,a,t,s,r,d){const i=B,n=P;return c(),l(i,{class:"tab-bar"},{default:u((()=>[p(i,{class:"tab-bar-border"}),(c(!0),g(h,null,f(r.list,((e,a)=>(c(),l(i,{key:a,class:"tab-bar-item",onClick:t=>d.switchTab(e,a)},{default:u((()=>[p(i,{class:"tab-icon"},{default:u((()=>[b(m(e.icon),1)])),_:2},1024),p(n,{class:x(["tab-text",{active:r.selected===a}])},{default:u((()=>[b(m(e.text),1)])),_:2},1032,["class"]),"pages/message/message"===e.pagePath&&r.unreadCount>0?(c(),l(i,{key:0,class:"badge"},{default:u((()=>[b(m(r.unreadCount>99?"99+":r.unreadCount),1)])),_:1})):_("",!0)])),_:2},1032,["onClick"])))),128))])),_:1})}],["__scopeId","data-v-06639aec"]]);function k(e,a){return"string"==typeof e?a:e}export{y as _,k as r};
