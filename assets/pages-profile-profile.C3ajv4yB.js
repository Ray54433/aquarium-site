import{t as e,u as s,a7 as a,a8 as t,U as l,q as i,B as n,l as o,A as c,C as u,a9 as r,n as d,s as f,N as m,aa as g,ab as h,D as _,c as p,w as y,i as v,o as k,a as C,b,J as I,H as M,L as w,E as S,F as U,G as N,e as x,d as D,S as P}from"./index-CcRA1RUw.js";import{r as j,_ as $}from"./uni-app.es.2SZY3XeM.js";import{_ as A}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=A({data:()=>({user:{},myPosts:[],points:0,isSignedToday:!1,isMe:!0,targetUserId:"",isAdmin:!1,isMod:!1}),onLoad(a){if(a.userId){const s=e();s&&String(s.id)===String(a.userId)?this.isMe=!0:(this.isMe=!1,this.targetUserId=a.userId,a.name&&(this.user={id:a.userId,name:decodeURIComponent(a.name),avatar:a.avatar?decodeURIComponent(a.avatar):""}))}else this.isMe=!0;this.loadData(),this.isMe&&s()},onShow(){this.isMe&&(this.loadData(),s())},computed:{level(){return Math.floor(this.points/100)+1},levelTitle(){return this.level>=20?"å‚³èªªç´šé­šå‹":this.level>=10?"è³‡æ·±é­šå‹":this.level>=5?"é€²éšŽé­šå‹":"æ–°æ‰‹é­šå‹"}},onUnload(){this.isMe&&a("userProfileUpdated")},methods:{async loadData(){var s,a,r;if(this.isMe){let o=e();try{const e=await t();if(e){o={...o||{},id:e.$id,name:e.name,email:e.email,avatar:(null==(s=e.prefs)?void 0:s.avatar)||(null==o?void 0:o.avatar)||"",bio:(null==(a=e.prefs)?void 0:a.bio)||(null==o?void 0:o.bio)||"",signature:(null==(r=e.prefs)?void 0:r.signature)||(null==o?void 0:o.signature)||""},l("currentUser",o)}}catch(m){console.log("Sync failed",m)}if(!o)return void i({url:"/pages/login/login"});this.user=o;const c=`signin_${o.id}`,u=n(c)||{points:0,lastDate:""};this.points=u.points||0;const d=(new Date).toDateString();this.isSignedToday=u.lastDate===d}else{const e=o().filter((e=>String(e.authorId)===String(this.targetUserId)));this.points=10*e.length;const s=c(this.targetUserId);if(s&&(this.user.avatar=s),!s&&e.length>0){const s=e[0];this.user.name=s.authorName,this.user.avatar=s.authorAvatar}}const d=o(),f=this.isMe?this.user.id:this.targetUserId;this.myPosts=d.filter((e=>String(e.authorId)===String(f))),this.myPosts.forEach((e=>{if("circle"===e.categoryId)e.categoryName=`å¹æ°´å»£å ´ - ${e.subCategoryId||""}`;else{const s=u.find((s=>s.id===e.categoryId));if(s){if(e.categoryName=s.name,e.subCategoryId&&s.children){const a=s.children.find((s=>s.id===e.subCategoryId));a&&(e.categoryName+=` - ${a.name}`)}}else e.categoryName="æœªåˆ†é¡ž"}}))},handleCheckIn(){if(this.isSignedToday)return;const e=r(this.user);e.isNew&&(this.points=e.points,this.isSignedToday=!0,d({title:"ç°½åˆ°æˆåŠŸ +5 äººæ°£å€¼",icon:"none"}))},editProfile(){i({url:"/pages/profile/edit"})},showMyPosts(){i({url:"/pages/profile/user-posts?type=discussion",fail:e=>{console.error("Navigate failed:",e),d({title:"è·³è½‰å¤±æ•—: "+JSON.stringify(e),icon:"none"})}})},showMyAuctions(){i({url:"/pages/profile/user-posts?type=auction",fail:e=>{console.error("Navigate failed:",e),d({title:"è·³è½‰å¤±æ•—: "+JSON.stringify(e),icon:"none"})}})},showMessages(){f({url:"/pages/message/message",fail:()=>{i({url:"/pages/message/message"})}})},showLikes(){i({url:"/pages/profile/likes"})},showFavorites(){i({url:"/pages/profile/favorites"})},showAchievements(){i({url:"/pages/profile/user-achievement",fail:e=>{console.error("Navigate failed:",e),d({title:"è·³è½‰å¤±æ•—: "+JSON.stringify(e),icon:"none"})}})},contactUs(){m({title:"è¯ç¹«æˆ‘å€‘",content:"å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹é›»éƒµè‡³ raychan19999@gmail.com",showCancel:!1})},logout(){m({title:"ç™»å‡º",content:"ç¢ºå®šè¦ç™»å‡ºå—Žï¼Ÿ",success:e=>{e.confirm&&(g("currentUser"),h({url:"/pages/login/login"}))}})},viewPost(e){i({url:`/pages/detail/detail?id=${e}`})},formatDate(e){if(!e)return"";const s=new Date(e<1e10?1e3*e:e);return`${s.getFullYear()}/${s.getMonth()+1}/${s.getDate()}`},startChat(){this.targetUserId&&i({url:`/pages/message/chat?targetId=${this.targetUserId}&targetName=${encodeURIComponent(this.user.name)}`})}}},[["render",function(e,s,a,t,l,i){const n=x,o=v,c=D,u=P,r=j(_("app-tab-bar"),$);return k(),p(o,{class:"container"},{default:y((()=>[C(o,{class:"notice-bar"},{default:y((()=>[C(o,{class:"notice-content"},{default:y((()=>[C(n,{class:"notice-text"},{default:y((()=>[b("ðŸ“¢ æœ¬ç‰ˆç‰ˆè¦ï¼šåš´ç¦ç™¼ä½ˆä»»ä½•è‰²æƒ…ã€æš´åŠ›ã€è³­åšåŠè©é¨™è¨Šæ¯ã€‚è«‹ä¿æŒç¦®è²Œï¼Œå°Šé‡ä»–äººã€‚é•è€…å°‡è¢«å°ç¦ã€‚")])),_:1})])),_:1})])),_:1}),C(o,{class:"profile-header"},{default:y((()=>[C(o,{class:"user-info-box"},{default:y((()=>[C(o,{class:"avatar-container"},{default:y((()=>[C(c,{src:l.user.avatar||"/static/logo.png",class:"avatar",mode:"aspectFill"},null,8,["src"]),C(o,{class:"level-badge"},{default:y((()=>[b("Lv."+I(i.level),1)])),_:1})])),_:1}),C(o,{class:"user-details"},{default:y((()=>[C(n,{class:"username"},{default:y((()=>[b(I(l.user.name)+" ",1),l.isAdmin?(k(),p(n,{key:0,class:"role-badge admin"},{default:y((()=>[b("å®˜æ–¹")])),_:1})):M("",!0),l.isMod?(k(),p(n,{key:1,class:"role-badge mod"},{default:y((()=>[b("ç‰ˆä¸»")])),_:1})):M("",!0)])),_:1}),l.isMe?(k(),p(n,{key:0,class:"user-email"},{default:y((()=>[b(I(l.user.email),1)])),_:1})):M("",!0),C(o,{class:"user-tags"},{default:y((()=>[C(n,{class:"tag"},{default:y((()=>[b(I(i.levelTitle),1)])),_:1}),C(n,{class:"tag points"},{default:y((()=>[b("ðŸ”¥ äººæ°£ "+I(l.points),1)])),_:1})])),_:1})])),_:1})])),_:1}),l.isMe?(k(),p(o,{key:0,class:"action-buttons"},{default:y((()=>[C(o,{class:"action-btn edit-btn",onClick:i.editProfile},{default:y((()=>[C(n,null,{default:y((()=>[b("ç·¨è¼¯è³‡æ–™")])),_:1})])),_:1},8,["onClick"]),C(o,{class:w(["action-btn sign-in-btn",{signed:l.isSignedToday}]),onClick:i.handleCheckIn},{default:y((()=>[C(n,null,{default:y((()=>[b(I(l.isSignedToday?"âœ… å·²ç°½åˆ°":"ðŸ“… æ¯æ—¥ç°½åˆ°"),1)])),_:1})])),_:1},8,["class","onClick"])])),_:1})):(k(),p(o,{key:1,class:"action-buttons"},{default:y((()=>[C(o,{class:"action-btn message-btn",onClick:i.startChat},{default:y((()=>[C(n,null,{default:y((()=>[b("ðŸ’¬ ç§è¨Š")])),_:1})])),_:1},8,["onClick"])])),_:1}))])),_:1}),l.isMe?(k(),p(o,{key:0,class:"menu-grid"},{default:y((()=>[C(o,{class:"menu-item",onClick:i.showMyPosts},{default:y((()=>[C(o,{class:"menu-icon-bg"},{default:y((()=>[C(n,{class:"menu-emoji"},{default:y((()=>[b("ðŸ“")])),_:1})])),_:1}),C(n,{class:"menu-text"},{default:y((()=>[b("æˆ‘çš„å¸–å­")])),_:1})])),_:1},8,["onClick"]),C(o,{class:"menu-item",onClick:i.showMyAuctions},{default:y((()=>[C(o,{class:"menu-icon-bg"},{default:y((()=>[C(n,{class:"menu-emoji"},{default:y((()=>[b("ðŸ”¨")])),_:1})])),_:1}),C(n,{class:"menu-text"},{default:y((()=>[b("æˆ‘çš„æ‹è³£")])),_:1})])),_:1},8,["onClick"]),C(o,{class:"menu-item",onClick:i.showMessages},{default:y((()=>[C(o,{class:"menu-icon-bg"},{default:y((()=>[C(n,{class:"menu-emoji"},{default:y((()=>[b("ðŸ’¬")])),_:1})])),_:1}),C(n,{class:"menu-text"},{default:y((()=>[b("æˆ‘çš„ç§ä¿¡")])),_:1})])),_:1},8,["onClick"]),C(o,{class:"menu-item",onClick:i.showLikes},{default:y((()=>[C(o,{class:"menu-icon-bg"},{default:y((()=>[C(n,{class:"menu-emoji"},{default:y((()=>[b("â¤ï¸")])),_:1})])),_:1}),C(n,{class:"menu-text"},{default:y((()=>[b("è®šå¥½å…§å®¹")])),_:1})])),_:1},8,["onClick"]),C(o,{class:"menu-item",onClick:i.showFavorites},{default:y((()=>[C(o,{class:"menu-icon-bg"},{default:y((()=>[C(n,{class:"menu-emoji"},{default:y((()=>[b("â­")])),_:1})])),_:1}),C(n,{class:"menu-text"},{default:y((()=>[b("æˆ‘çš„æ”¶è—")])),_:1})])),_:1},8,["onClick"]),C(o,{class:"menu-item",onClick:i.showAchievements},{default:y((()=>[C(o,{class:"menu-icon-bg"},{default:y((()=>[C(n,{class:"menu-emoji"},{default:y((()=>[b("ðŸ†")])),_:1})])),_:1}),C(n,{class:"menu-text"},{default:y((()=>[b("æˆ‘çš„æˆå°±")])),_:1})])),_:1},8,["onClick"]),C(o,{class:"menu-item",onClick:i.contactUs},{default:y((()=>[C(o,{class:"menu-icon-bg"},{default:y((()=>[C(n,{class:"menu-emoji"},{default:y((()=>[b("ðŸ“ž")])),_:1})])),_:1}),C(n,{class:"menu-text"},{default:y((()=>[b("è¯ç¹«æˆ‘å€‘")])),_:1})])),_:1},8,["onClick"]),C(o,{class:"menu-item",onClick:i.logout},{default:y((()=>[C(o,{class:"menu-icon-bg logout"},{default:y((()=>[C(n,{class:"menu-emoji"},{default:y((()=>[b("ðŸšª")])),_:1})])),_:1}),C(n,{class:"menu-text"},{default:y((()=>[b("ç™»å‡º")])),_:1})])),_:1},8,["onClick"])])),_:1})):M("",!0),C(o,{class:"section-header"},{default:y((()=>[C(n,{class:"section-title"},{default:y((()=>[b("æˆ‘çš„å‹•æ…‹")])),_:1})])),_:1}),C(u,{"scroll-y":"",class:"posts-list"},{default:y((()=>[0===l.myPosts.length?(k(),p(o,{key:0,class:"empty-state"},{default:y((()=>[C(n,null,{default:y((()=>[b("ä½ é‚„æ²’æœ‰ç™¼ä½ˆéŽå¸–å­")])),_:1})])),_:1})):(k(!0),S(N,{key:1},U(l.myPosts,(e=>(k(),p(o,{class:"post-item",key:e.id,onClick:s=>i.viewPost(e.id)},{default:y((()=>[C(n,{class:"post-title"},{default:y((()=>[b(I(e.title),1)])),_:2},1024),C(n,{class:"post-meta"},{default:y((()=>[b(I(e.categoryName||"æœªåˆ†é¡ž")+" Â· "+I(i.formatDate(e.timestamp)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),C(r,{selectedBase:4})])),_:1})}],["__scopeId","data-v-9f539e76"]]);export{T as default};
