import{n as e,j as i,ao as s,p as a,ap as t,aq as l,ar as o,as as n,N as r,B as c,U as d,ak as u,ai as p,s as m,c as f,w as h,i as g,o as y,a as _,b as w,J as V,H as v,d as k,e as C,I as U,a6 as I}from"./index-D3P_GraJ.js";import{_ as b}from"./logo.CtHxZGvc.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const R=x({data:()=>({isRegister:!1,isVerifying:!1,email:"",password:"",verificationCode:"",tempUserId:"",useBackend:!0}),methods:{toggleMode(){this.isRegister=!this.isRegister,this.email="",this.password=""},cancelVerification(){this.isVerifying=!1,this.verificationCode="",this.tempUserId=""},async handleSubmit(){this.email&&this.password?this.isRegister?await this.register():await this.login():e({title:"è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½",icon:"none"})},async register(){if(this.useBackend){i({title:"è™•ç†ä¸­..."});const{data:o,error:n}=await s(this.email,this.password);if(n)return a(),void e({title:n.message||"è¨»å†Šå¤±æ•—",icon:"none"});if(o&&o.user){this.tempUserId=o.user.$id;const{error:i}=await t(this.tempUserId,this.email);a(),i?e({title:"é©—è­‰ç¢¼ç™¼é€å¤±æ•—ï¼Œè«‹é‡è©¦",icon:"none"}):(e({title:"é©—è­‰ç¢¼å·²ç™¼é€",icon:"success"}),this.isVerifying=!0,await l())}}else e({title:"è«‹å•Ÿç”¨å¾Œç«¯æœå‹™",icon:"none"})},async handleVerification(){if(!this.verificationCode)return void e({title:"è«‹è¼¸å…¥é©—è­‰ç¢¼",icon:"none"});i({title:"é©—è­‰ä¸­..."});const{data:s,error:t}=await o(this.tempUserId,this.verificationCode);if(a(),t)e({title:"é©—è­‰å¤±æ•—: "+(t.message||"é©—è­‰ç¢¼éŒ¯èª¤"),icon:"none"});else if(s&&s.session){e({title:"é©—è­‰æˆåŠŸ",icon:"success"});const i={id:s.user.$id,email:s.user.email,name:s.user.name||s.user.email.split("@")[0],loginType:"email"};this.completeLogin(i)}},async login(){if(this.useBackend){i({title:"ç™»å…¥ä¸­..."});const{data:s,error:o}=await n(this.email,this.password);if(a(),o)return void e({title:"ç™»å…¥å¤±æ•—: "+(o.message||"æœªçŸ¥éŒ¯èª¤"),icon:"none"});if(s.user){if(!1===s.user.emailVerification)return void r({title:"å¸³è™Ÿæœªé©—è­‰",content:"æ‚¨çš„å¸³è™Ÿå°šæœªå®Œæˆéƒµç®±é©—è­‰ï¼Œæ˜¯å¦ç¾åœ¨é©—è­‰ï¼Ÿ",success:async o=>{if(o.confirm){this.tempUserId=s.user.$id,i({title:"ç™¼é€é©—è­‰ç¢¼..."});const{error:o}=await t(this.tempUserId,this.email);a(),o?e({title:"ç™¼é€å¤±æ•—",icon:"none"}):(this.isVerifying=!0,await l())}else await l()}});const o={id:s.user.$id,email:s.user.email,name:s.user.name||s.user.email.split("@")[0],loginType:"email"};this.completeLogin(o)}}else e({title:"è«‹å•Ÿç”¨å¾Œç«¯æœå‹™",icon:"none"})},async completeLogin(i,s=-1,a=null){a||(s=(a=c("users")||[]).findIndex((e=>e.id===i.id||i.email&&e.email===i.email)));const t=Date.now();i.loginHistory||(i.loginHistory=[]),i.loginHistory.push(t);const l=t-6048e5;i.loginHistory=i.loginHistory.filter((e=>e>l)),-1!==s?a[s]={...a[s],...i}:a.push(i),d("users",a),d("currentUser",-1!==s?a[s]:i),await u(),e({title:"ç™»å…¥æˆåŠŸ"}),p("userSignedIn",i),setTimeout((()=>{m({url:"/pages/home/home"})}),1e3)}}},[["render",function(e,i,s,a,t,l){const o=g,n=k,r=C,c=U,d=I;return y(),f(o,{class:"container"},{default:h((()=>[_(o,{class:"header-bg"}),_(o,{class:"content-wrapper"},{default:h((()=>[_(o,{class:"logo-area"},{default:h((()=>[_(n,{class:"logo",src:b,mode:"aspectFit"}),_(r,{class:"app-title"},{default:h((()=>[w("é¦™æ¸¯æ°´æ—äº¤æµå€")])),_:1}),_(r,{class:"app-subtitle"},{default:h((()=>[w("é€£æŽ¥å…¨æ¸¯æ°´æ—æ„›å¥½è€…")])),_:1})])),_:1}),_(o,{class:"form-card"},{default:h((()=>[_(r,{class:"form-title"},{default:h((()=>[w(V(t.isVerifying?"é©—è­‰éƒµç®±":t.isRegister?"è¨»å†Šå¸³è™Ÿ":"æ­¡è¿Žç™»å…¥"),1)])),_:1}),t.isVerifying?(y(),f(o,{key:1},{default:h((()=>[_(r,{class:"verify-hint"},{default:h((()=>[w("é©—è­‰ç¢¼å·²ç™¼é€è‡³ "+V(t.email),1)])),_:1}),_(o,{class:"input-group"},{default:h((()=>[_(r,{class:"input-icon"},{default:h((()=>[w("ðŸ”¢")])),_:1}),_(c,{class:"input",type:"text",modelValue:t.verificationCode,"onUpdate:modelValue":i[2]||(i[2]=e=>t.verificationCode=e),placeholder:"è«‹è¼¸å…¥6ä½é©—è­‰ç¢¼","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),_(d,{class:"btn-primary",onClick:l.handleVerification,"hover-class":"btn-hover"},{default:h((()=>[w("æäº¤é©—è­‰")])),_:1},8,["onClick"]),_(o,{class:"toggle-area",onClick:l.cancelVerification},{default:h((()=>[_(r,{class:"toggle-text"},{default:h((()=>[w("è¿”å›žä¿®æ”¹éƒµç®±")])),_:1})])),_:1},8,["onClick"])])),_:1})):(y(),f(o,{key:0},{default:h((()=>[_(o,{class:"input-group"},{default:h((()=>[_(r,{class:"input-icon"},{default:h((()=>[w("ðŸ“§")])),_:1}),_(c,{class:"input",type:"text",modelValue:t.email,"onUpdate:modelValue":i[0]||(i[0]=e=>t.email=e),placeholder:"é›»å­éƒµä»¶","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),_(o,{class:"input-group"},{default:h((()=>[_(r,{class:"input-icon"},{default:h((()=>[w("ðŸ”’")])),_:1}),_(c,{class:"input",type:"password",modelValue:t.password,"onUpdate:modelValue":i[1]||(i[1]=e=>t.password=e),placeholder:"å¯†ç¢¼","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),_(d,{class:"btn-primary",onClick:l.handleSubmit,"hover-class":"btn-hover"},{default:h((()=>[w(V(t.isRegister?"è¨»å†Šä¸¦é©—è­‰":"ç™»å…¥"),1)])),_:1},8,["onClick"])])),_:1})),t.isVerifying?v("",!0):(y(),f(o,{key:2,class:"toggle-area",onClick:l.toggleMode},{default:h((()=>[_(r,{class:"toggle-text"},{default:h((()=>[w(V(t.isRegister?"å·²æœ‰å¸³è™Ÿï¼ŸåŽ»ç™»å…¥":"æ²’æœ‰å¸³è™Ÿï¼ŸåŽ»è¨»å†Š"),1)])),_:1})])),_:1},8,["onClick"]))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-95614049"]]);export{R as default};
