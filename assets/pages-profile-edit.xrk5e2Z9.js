import{a7 as a,T as e,A as s,p as t,a2 as r,m as l,h as i,a3 as o,ab as u,ac as n,k as c,ad as d,n as m,ae as h,Z as f,B as p,c as v,w as g,i as _,o as b,a as w,b as x,e as V,d as U,I as y,af as P,a5 as A}from"./index-DqSEOK9I.js";import{r as k,_ as E}from"./uni-app.es.DBZf2cEO.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const N=I({data:()=>({user:{id:"",name:"",email:"",avatar:"",bio:"",signature:""},tempAvatarPath:""}),async onLoad(){await this.loadUser()},methods:{async loadUser(){var r,l,i;const o=await a();if(o)this.user={id:o.$id,name:o.name,email:o.email,avatar:(null==(r=o.prefs)?void 0:r.avatar)||"",bio:(null==(l=o.prefs)?void 0:l.bio)||"",signature:(null==(i=o.prefs)?void 0:i.signature)||""},e("currentUser",this.user);else{const a=s("currentUser");a?this.user=JSON.parse(JSON.stringify(a)):t({url:"/pages/login/login"})}},changeAvatar(){r({count:1,success:a=>{this.tempAvatarPath=a.tempFilePaths[0],this.user.avatar=a.tempFilePaths[0]}})},async saveProfile(){if(this.user.name){i({title:"ä¿å­˜ä¸­..."});try{if(this.tempAvatarPath){const{data:a,error:e}=await o(this.tempAvatarPath);if(e)throw new Error("é ­åƒä¸Šå‚³å¤±æ•—: "+(e.message||JSON.stringify(e)));this.user.avatar=a.url}const{error:a}=await u(this.user.name);if(a)throw new Error("æ›´æ–°æš±ç¨±å¤±æ•—: "+a.message);const t={bio:this.user.bio||"",signature:this.user.signature||"",avatar:this.user.avatar||""},{error:r}=await n(t);if(r)throw new Error("æ›´æ–°å€‹äººè³‡æ–™å¤±æ•—: "+r.message);e("currentUser",this.user);let i=s("users")||[];const p=i.findIndex((a=>a.id===this.user.id));-1!==p&&(i[p]={...i[p],...this.user},e("users",i));let v=c(),g=!1;v.forEach((a=>{a.authorId===this.user.id&&(a.authorName=this.user.name,g=!0),a.comments&&a.comments.forEach((a=>{a.authorId===this.user.id&&(a.authorName=this.user.name,g=!0)}))})),g&&d(v),m(),l({title:"ä¿å­˜æˆåŠŸ"}),h("userProfileUpdated",this.user),setTimeout((()=>{f()}),1e3)}catch(a){m(),console.error(a),l({title:a.message||"ä¿å­˜å¤±æ•—",icon:"none"})}}else l({title:"æš±ç¨±ä¸èƒ½ç‚ºç©º",icon:"none"})}}},[["render",function(a,e,s,t,r,l){const i=V,o=_,u=U,n=y,c=P,d=A,m=k(p("app-tab-bar"),E);return b(),v(o,{class:"container"},{default:g((()=>[w(o,{class:"notice-bar"},{default:g((()=>[w(o,{class:"notice-content"},{default:g((()=>[w(i,{class:"notice-text"},{default:g((()=>[x("ğŸ“¢ æœ¬ç‰ˆç‰ˆè¦ï¼šåš´ç¦ç™¼ä½ˆä»»ä½•è‰²æƒ…ã€æš´åŠ›ã€è³­åšåŠè©é¨™è¨Šæ¯ã€‚è«‹ä¿æŒç¦®è²Œï¼Œå°Šé‡ä»–äººã€‚é•è€…å°‡è¢«å°ç¦ã€‚")])),_:1})])),_:1})])),_:1}),w(o,{class:"avatar-section",onClick:l.changeAvatar},{default:g((()=>[w(u,{class:"avatar",src:r.user.avatar||"/static/logo.png",mode:"aspectFill"},null,8,["src"]),w(i,{class:"change-avatar-text"},{default:g((()=>[x("æ›´æ›é ­åƒ")])),_:1})])),_:1},8,["onClick"]),w(o,{class:"form-section"},{default:g((()=>[w(o,{class:"form-item"},{default:g((()=>[w(i,{class:"label"},{default:g((()=>[x("æš±ç¨±")])),_:1}),w(n,{class:"input",type:"text",modelValue:r.user.name,"onUpdate:modelValue":e[0]||(e[0]=a=>r.user.name=a),placeholder:"è«‹è¼¸å…¥æš±ç¨±"},null,8,["modelValue"])])),_:1}),w(o,{class:"form-item"},{default:g((()=>[w(i,{class:"label"},{default:g((()=>[x("é›»å­éƒµä»¶ (ä¸å¯ä¿®æ”¹)")])),_:1}),w(n,{class:"input disabled",type:"text",modelValue:r.user.email,"onUpdate:modelValue":e[1]||(e[1]=a=>r.user.email=a),disabled:""},null,8,["modelValue"])])),_:1}),w(o,{class:"form-item"},{default:g((()=>[w(i,{class:"label"},{default:g((()=>[x("å€‹äººç°¡ä»‹")])),_:1}),w(c,{class:"textarea",modelValue:r.user.bio,"onUpdate:modelValue":e[2]||(e[2]=a=>r.user.bio=a),placeholder:"ä»‹ç´¹ä¸€ä¸‹è‡ªå·±å§...",maxlength:"100"},null,8,["modelValue"])])),_:1}),w(o,{class:"form-item"},{default:g((()=>[w(i,{class:"label"},{default:g((()=>[x("å€‹æ€§ç°½å")])),_:1}),w(n,{class:"input",type:"text",modelValue:r.user.signature,"onUpdate:modelValue":e[3]||(e[3]=a=>r.user.signature=a),placeholder:"ä¸€å¥è©±ä»£è¡¨ä½ ",maxlength:"30"},null,8,["modelValue"])])),_:1})])),_:1}),w(d,{class:"save-btn",onClick:l.saveProfile},{default:g((()=>[x("ä¿å­˜ä¿®æ”¹")])),_:1},8,["onClick"]),w(m)])),_:1})}],["__scopeId","data-v-4064849c"]]);export{N as default};
