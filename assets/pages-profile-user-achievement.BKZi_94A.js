import{ag as s,f as e,ah as a,a6 as t,r as l,p as n,A as i,a8 as c,m as d,k as o,B as r,c as u,w as h,i as f,o as g,a as k,b as _,H as p,ai as m,K as v,D as b,E as y,F as S,e as D,d as I,G as x}from"./index-1UdTh2kG.js";import{r as T,_ as B}from"./uni-app.es.D-AGfr41.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=C({data:()=>({user:{},points:0,isSignedToday:!1,lastSignInDate:null,streakDays:0,totalCheckIns:0,badges:[{id:"newbie",name:"åˆå…¥æ°´æ—",icon:"ðŸ ",desc:"æˆåŠŸè¨»å†Šå¸³è™Ÿ",unlocked:!0},{id:"first_post",name:"ç©æ¥µç™¼è¨€",icon:"ðŸ“",desc:"ç™¼ä½ˆç¬¬ 1 å€‹å¸–å­",unlocked:!1},{id:"social",name:"äº¤éš›èŠ±",icon:"â¤ï¸",desc:"ç²å¾— 10 å€‹è®šå¥½",unlocked:!1},{id:"influencer",name:"æ°´æ—é”äºº",icon:"ðŸŒŸ",desc:"äººæ°£å€¼é”åˆ° 100",unlocked:!1},{id:"expert",name:"å¤§å¸«ç´š",icon:"ðŸ‘‘",desc:"äººæ°£å€¼é”åˆ° 1000",unlocked:!1},{id:"merchant",name:"èª ä¿¡è³£å®¶",icon:"ðŸ¤",desc:"å®Œæˆ 1 æ¬¡äº¤æ˜“",unlocked:!1}]}),computed:{level(){return Math.floor(this.points/100)+1},nextLevelPoints(){return 100*this.level},progressPercent(){const s=100*(this.level-1),e=this.points-s;return Math.min(100,e/100*100)},levelTitle(){return this.level>=20?"å‚³èªªç´šé­šå‹":this.level>=10?"è³‡æ·±é­šå‹":this.level>=5?"é€²éšŽé­šå‹":"æ–°æ‰‹é­šå‹"},rank(){return Math.max(1,100-Math.floor(this.points/5))}},onShow(){this.loadData(),s().then((()=>{this.loadData()}))},onPullDownRefresh(){this.loadData(),setTimeout((()=>{e()}),1e3)},onLoad(){a("userSignedIn",this.handleSignInUpdate)},onUnload(){t("userSignedIn",this.handleSignInUpdate)},methods:{loadData(){const s=l();if(!s)return void n({url:"/pages/login/login"});this.user=s;const e=`signin_${s.id}`,a=i(e)||{points:0,lastDate:"",streak:0,total:0};this.points=a.points||0,this.lastSignInDate=a.lastDate,this.streakDays=a.streak||0,this.totalCheckIns=a.total||0;const t=(new Date).toDateString();this.isSignedToday=this.lastSignInDate===t,console.log("Achievement loaded:",{points:this.points,isSignedToday:this.isSignedToday}),this.checkBadges()},handleSignInUpdate(s){console.log("Received sign in update:",s),this.loadData()},handleCheckIn(){if(this.isSignedToday)return;const s=c(this.user);s.isNew&&(this.points=s.points,this.isSignedToday=!0,this.streakDays=s.streak||this.streakDays+1,this.totalCheckIns=(this.totalCheckIns||0)+1,d({title:"ç°½åˆ°æˆåŠŸï¼",icon:"success"}),this.checkBadges())},checkBadges(){const s=o().filter((s=>s.authorId===this.user.id));s.length>0&&this.unlockBadge("first_post");let e=0;s.forEach((s=>{s.likes&&Array.isArray(s.likes)&&(e+=s.likes.length)})),e>=10&&this.unlockBadge("social"),this.points>=100&&this.unlockBadge("influencer"),this.points>=1e3&&this.unlockBadge("expert")},unlockBadge(s){const e=this.badges.find((e=>e.id===s));e&&!e.unlocked&&(e.unlocked=!0)}}},[["render",function(s,e,a,t,l,n){const i=D,c=f,d=I,o=T(r("app-tab-bar"),B);return g(),u(c,{class:"container"},{default:h((()=>[k(c,{class:"notice-bar"},{default:h((()=>[k(c,{class:"notice-content"},{default:h((()=>[k(i,{class:"notice-text"},{default:h((()=>[_("ðŸ“¢ æœ¬ç‰ˆç‰ˆè¦ï¼šåš´ç¦ç™¼ä½ˆä»»ä½•è‰²æƒ…ã€æš´åŠ›ã€è³­åšåŠè©é¨™è¨Šæ¯ã€‚è«‹ä¿æŒç¦®è²Œï¼Œå°Šé‡ä»–äººã€‚é•è€…å°‡è¢«å°ç¦ã€‚")])),_:1})])),_:1})])),_:1}),k(c,{class:"level-header"},{default:h((()=>[k(c,{class:"user-avatar-box"},{default:h((()=>[k(d,{src:l.user.avatar||"/static/logo.png",class:"avatar",mode:"aspectFill"},null,8,["src"]),k(c,{class:"level-badge"},{default:h((()=>[_("Lv."+p(n.level),1)])),_:1})])),_:1}),k(i,{class:"username"},{default:h((()=>[_(p(l.user.name),1)])),_:1}),k(i,{class:"level-title"},{default:h((()=>[_(p(n.levelTitle),1)])),_:1}),k(c,{class:"progress-section"},{default:h((()=>[k(c,{class:"progress-info"},{default:h((()=>[k(i,null,{default:h((()=>[_("äººæ°£å€¼ "+p(l.points),1)])),_:1}),k(i,null,{default:h((()=>[_("ä¸‹ä¸€ç­‰ç´š "+p(n.nextLevelPoints),1)])),_:1})])),_:1}),k(c,{class:"progress-bar-bg"},{default:h((()=>[k(c,{class:"progress-bar-fill",style:m({width:n.progressPercent+"%"})},null,8,["style"])])),_:1}),k(i,{class:"progress-tips"},{default:h((()=>[_("é‚„å·® "+p(n.nextLevelPoints-l.points)+" äººæ°£å‡ç´š",1)])),_:1})])),_:1})])),_:1}),k(c,{class:"card check-in-card"},{default:h((()=>[k(c,{class:"card-header"},{default:h((()=>[k(i,{class:"card-title"},{default:h((()=>[_("æ¯æ—¥ç°½åˆ°")])),_:1}),k(i,{class:"streak-text"},{default:h((()=>[_("å·²é€£çºŒç°½åˆ° "+p(l.streakDays)+" å¤©",1)])),_:1})])),_:1}),k(c,{class:"check-in-content"},{default:h((()=>[k(c,{class:v(["check-in-btn",{checked:l.isSignedToday}]),onClick:n.handleCheckIn},{default:h((()=>[k(i,{class:"check-in-icon"},{default:h((()=>[_(p(l.isSignedToday?"âœ…":"ðŸ“…"),1)])),_:1}),k(i,{class:"check-in-text"},{default:h((()=>[_(p(l.isSignedToday?"ä»Šæ—¥å·²ç°½åˆ°":"é»žæ“Šç°½åˆ°"),1)])),_:1})])),_:1},8,["class","onClick"]),l.isSignedToday?(g(),u(i,{key:1,class:"check-in-desc"},{default:h((()=>[_("æ˜Žå¤©ç¹¼çºŒä¾†ç°½åˆ°å§ï¼")])),_:1})):(g(),u(i,{key:0,class:"check-in-desc"},{default:h((()=>[_("ç°½åˆ°å¯ç²å¾— +5 äººæ°£ï¼Œé€£çºŒç°½åˆ°æœ‰é¡å¤–çŽå‹µï¼")])),_:1}))])),_:1})])),_:1}),k(c,{class:"stats-grid"},{default:h((()=>[k(c,{class:"stat-item"},{default:h((()=>[k(i,{class:"stat-value"},{default:h((()=>[_(p(l.points),1)])),_:1}),k(i,{class:"stat-label"},{default:h((()=>[_("ç¸½äººæ°£")])),_:1})])),_:1}),k(c,{class:"stat-item"},{default:h((()=>[k(i,{class:"stat-value"},{default:h((()=>[_(p(l.totalCheckIns),1)])),_:1}),k(i,{class:"stat-label"},{default:h((()=>[_("ç¸½ç°½åˆ°å¤©æ•¸")])),_:1})])),_:1}),k(c,{class:"stat-item"},{default:h((()=>[k(i,{class:"stat-value"},{default:h((()=>[_(p(n.rank),1)])),_:1}),k(i,{class:"stat-label"},{default:h((()=>[_("å…¨æœæŽ’å")])),_:1})])),_:1})])),_:1}),k(c,{class:"section-title"},{default:h((()=>[_("æˆ‘çš„æˆå°±å¾½ç« ")])),_:1}),k(c,{class:"badges-grid"},{default:h((()=>[(g(!0),b(S,null,y(l.badges,((s,e)=>(g(),u(c,{class:v(["badge-item",{locked:!s.unlocked}]),key:e},{default:h((()=>[k(c,{class:"badge-icon-box"},{default:h((()=>[k(i,{class:"badge-icon"},{default:h((()=>[_(p(s.icon),1)])),_:2},1024),s.unlocked?x("",!0):(g(),u(c,{key:0,class:"lock-overlay"},{default:h((()=>[_("ðŸ”’")])),_:1}))])),_:2},1024),k(i,{class:"badge-name"},{default:h((()=>[_(p(s.name),1)])),_:2},1024),k(i,{class:"badge-desc"},{default:h((()=>[_(p(s.desc),1)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1}),k(o)])),_:1})}],["__scopeId","data-v-ce5c3ca4"]]);export{w as default};
