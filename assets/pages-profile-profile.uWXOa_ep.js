import{r as e,u as s,a6 as a,a7 as t,T as l,p as i,A as n,k as o,C as c,a8 as u,m as r,s as d,M as f,a9 as m,aa as g,B as h,c as _,w as p,i as y,o as v,a as k,b as C,H as b,G as I,K as M,D as w,E as S,F as U,e as N,d as x,S as D}from"./index-cizoypdI.js";import{r as P,_ as j}from"./uni-app.es.EehqqviQ.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const T=$({data:()=>({user:{},myPosts:[],points:0,isSignedToday:!1,isMe:!0,targetUserId:"",isAdmin:!1,isMod:!1}),onLoad(a){if(a.userId){const s=e();s&&String(s.id)===String(a.userId)?this.isMe=!0:(this.isMe=!1,this.targetUserId=a.userId,a.name&&(this.user={id:a.userId,name:decodeURIComponent(a.name),avatar:a.avatar?decodeURIComponent(a.avatar):""}))}else this.isMe=!0;this.loadData(),this.isMe&&s()},onShow(){this.isMe&&(this.loadData(),s())},computed:{level(){return Math.floor(this.points/100)+1},levelTitle(){return this.level>=20?"å‚³èªªç´šé­šå‹":this.level>=10?"è³‡æ·±é­šå‹":this.level>=5?"é€²éšŽé­šå‹":"æ–°æ‰‹é­šå‹"}},onUnload(){this.isMe&&a("userProfileUpdated")},methods:{async loadData(){var s,a,u;if(this.isMe){let o=e();try{const e=await t();if(e){o={...o||{},id:e.$id,name:e.name,email:e.email,avatar:(null==(s=e.prefs)?void 0:s.avatar)||(null==o?void 0:o.avatar)||"",bio:(null==(a=e.prefs)?void 0:a.bio)||(null==o?void 0:o.bio)||"",signature:(null==(u=e.prefs)?void 0:u.signature)||(null==o?void 0:o.signature)||""},l("currentUser",o)}}catch(f){console.log("Sync failed",f)}if(!o)return void i({url:"/pages/login/login"});this.user=o;const c=`signin_${o.id}`,r=n(c)||{points:0,lastDate:""};this.points=r.points||0;const d=(new Date).toDateString();this.isSignedToday=r.lastDate===d}else{const e=o().filter((e=>String(e.authorId)===String(this.targetUserId)));if(this.points=10*e.length,e.length>0){const s=e[0];this.user.name=s.authorName,this.user.avatar=s.authorAvatar}}const r=o(),d=this.isMe?this.user.id:this.targetUserId;this.myPosts=r.filter((e=>String(e.authorId)===String(d))),this.myPosts.forEach((e=>{if("circle"===e.categoryId)e.categoryName=`å¹æ°´å»£å ´ - ${e.subCategoryId||""}`;else{const s=c.find((s=>s.id===e.categoryId));if(s){if(e.categoryName=s.name,e.subCategoryId&&s.children){const a=s.children.find((s=>s.id===e.subCategoryId));a&&(e.categoryName+=` - ${a.name}`)}}else e.categoryName="æœªåˆ†é¡ž"}}))},handleCheckIn(){if(this.isSignedToday)return;const e=u(this.user);e.isNew&&(this.points=e.points,this.isSignedToday=!0,r({title:"ç°½åˆ°æˆåŠŸ +5 äººæ°£å€¼",icon:"none"}))},editProfile(){i({url:"/pages/profile/edit"})},showMyPosts(){i({url:"/pages/profile/user-posts?type=discussion",fail:e=>{console.error("Navigate failed:",e),r({title:"è·³è½‰å¤±æ•—: "+JSON.stringify(e),icon:"none"})}})},showMyAuctions(){i({url:"/pages/profile/user-posts?type=auction",fail:e=>{console.error("Navigate failed:",e),r({title:"è·³è½‰å¤±æ•—: "+JSON.stringify(e),icon:"none"})}})},showMessages(){d({url:"/pages/message/message",fail:()=>{i({url:"/pages/message/message"})}})},showLikes(){i({url:"/pages/profile/likes"})},showFavorites(){i({url:"/pages/profile/favorites"})},showAchievements(){i({url:"/pages/profile/user-achievement",fail:e=>{console.error("Navigate failed:",e),r({title:"è·³è½‰å¤±æ•—: "+JSON.stringify(e),icon:"none"})}})},contactUs(){f({title:"è¯ç¹«æˆ‘å€‘",content:"å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹é›»éƒµè‡³ raychan19999@gmail.com",showCancel:!1})},logout(){f({title:"ç™»å‡º",content:"ç¢ºå®šè¦ç™»å‡ºå—Žï¼Ÿ",success:e=>{e.confirm&&(m("currentUser"),g({url:"/pages/login/login"}))}})},viewPost(e){i({url:`/pages/detail/detail?id=${e}`})},formatDate(e){if(!e)return"";const s=new Date(e<1e10?1e3*e:e);return`${s.getFullYear()}/${s.getMonth()+1}/${s.getDate()}`},startChat(){this.targetUserId&&i({url:`/pages/message/chat?targetId=${this.targetUserId}&targetName=${encodeURIComponent(this.user.name)}`})}}},[["render",function(e,s,a,t,l,i){const n=N,o=y,c=x,u=D,r=P(h("app-tab-bar"),j);return v(),_(o,{class:"container"},{default:p((()=>[k(o,{class:"notice-bar"},{default:p((()=>[k(o,{class:"notice-content"},{default:p((()=>[k(n,{class:"notice-text"},{default:p((()=>[C("ðŸ“¢ æœ¬ç‰ˆç‰ˆè¦ï¼šåš´ç¦ç™¼ä½ˆä»»ä½•è‰²æƒ…ã€æš´åŠ›ã€è³­åšåŠè©é¨™è¨Šæ¯ã€‚è«‹ä¿æŒç¦®è²Œï¼Œå°Šé‡ä»–äººã€‚é•è€…å°‡è¢«å°ç¦ã€‚")])),_:1})])),_:1})])),_:1}),k(o,{class:"profile-header"},{default:p((()=>[k(o,{class:"user-info-box"},{default:p((()=>[k(o,{class:"avatar-container"},{default:p((()=>[k(c,{src:l.user.avatar||"/static/logo.png",class:"avatar",mode:"aspectFill"},null,8,["src"]),k(o,{class:"level-badge"},{default:p((()=>[C("Lv."+b(i.level),1)])),_:1})])),_:1}),k(o,{class:"user-details"},{default:p((()=>[k(n,{class:"username"},{default:p((()=>[C(b(l.user.name)+" ",1),l.isAdmin?(v(),_(n,{key:0,class:"role-badge admin"},{default:p((()=>[C("å®˜æ–¹")])),_:1})):I("",!0),l.isMod?(v(),_(n,{key:1,class:"role-badge mod"},{default:p((()=>[C("ç‰ˆä¸»")])),_:1})):I("",!0)])),_:1}),l.isMe?(v(),_(n,{key:0,class:"user-email"},{default:p((()=>[C(b(l.user.email),1)])),_:1})):I("",!0),k(o,{class:"user-tags"},{default:p((()=>[k(n,{class:"tag"},{default:p((()=>[C(b(i.levelTitle),1)])),_:1}),k(n,{class:"tag points"},{default:p((()=>[C("ðŸ”¥ äººæ°£ "+b(l.points),1)])),_:1})])),_:1})])),_:1})])),_:1}),l.isMe?(v(),_(o,{key:0,class:"action-buttons"},{default:p((()=>[k(o,{class:"action-btn edit-btn",onClick:i.editProfile},{default:p((()=>[k(n,null,{default:p((()=>[C("ç·¨è¼¯è³‡æ–™")])),_:1})])),_:1},8,["onClick"]),k(o,{class:M(["action-btn sign-in-btn",{signed:l.isSignedToday}]),onClick:i.handleCheckIn},{default:p((()=>[k(n,null,{default:p((()=>[C(b(l.isSignedToday?"âœ… å·²ç°½åˆ°":"ðŸ“… æ¯æ—¥ç°½åˆ°"),1)])),_:1})])),_:1},8,["class","onClick"])])),_:1})):(v(),_(o,{key:1,class:"action-buttons"},{default:p((()=>[k(o,{class:"action-btn message-btn",onClick:i.startChat},{default:p((()=>[k(n,null,{default:p((()=>[C("ðŸ’¬ ç§è¨Š")])),_:1})])),_:1},8,["onClick"])])),_:1}))])),_:1}),l.isMe?(v(),_(o,{key:0,class:"menu-grid"},{default:p((()=>[k(o,{class:"menu-item",onClick:i.showMyPosts},{default:p((()=>[k(o,{class:"menu-icon-bg"},{default:p((()=>[k(n,{class:"menu-emoji"},{default:p((()=>[C("ðŸ“")])),_:1})])),_:1}),k(n,{class:"menu-text"},{default:p((()=>[C("æˆ‘çš„å¸–å­")])),_:1})])),_:1},8,["onClick"]),k(o,{class:"menu-item",onClick:i.showMyAuctions},{default:p((()=>[k(o,{class:"menu-icon-bg"},{default:p((()=>[k(n,{class:"menu-emoji"},{default:p((()=>[C("ðŸ”¨")])),_:1})])),_:1}),k(n,{class:"menu-text"},{default:p((()=>[C("æˆ‘çš„æ‹è³£")])),_:1})])),_:1},8,["onClick"]),k(o,{class:"menu-item",onClick:i.showMessages},{default:p((()=>[k(o,{class:"menu-icon-bg"},{default:p((()=>[k(n,{class:"menu-emoji"},{default:p((()=>[C("ðŸ’¬")])),_:1})])),_:1}),k(n,{class:"menu-text"},{default:p((()=>[C("æˆ‘çš„ç§ä¿¡")])),_:1})])),_:1},8,["onClick"]),k(o,{class:"menu-item",onClick:i.showLikes},{default:p((()=>[k(o,{class:"menu-icon-bg"},{default:p((()=>[k(n,{class:"menu-emoji"},{default:p((()=>[C("â¤ï¸")])),_:1})])),_:1}),k(n,{class:"menu-text"},{default:p((()=>[C("è®šå¥½å…§å®¹")])),_:1})])),_:1},8,["onClick"]),k(o,{class:"menu-item",onClick:i.showFavorites},{default:p((()=>[k(o,{class:"menu-icon-bg"},{default:p((()=>[k(n,{class:"menu-emoji"},{default:p((()=>[C("â­")])),_:1})])),_:1}),k(n,{class:"menu-text"},{default:p((()=>[C("æˆ‘çš„æ”¶è—")])),_:1})])),_:1},8,["onClick"]),k(o,{class:"menu-item",onClick:i.showAchievements},{default:p((()=>[k(o,{class:"menu-icon-bg"},{default:p((()=>[k(n,{class:"menu-emoji"},{default:p((()=>[C("ðŸ†")])),_:1})])),_:1}),k(n,{class:"menu-text"},{default:p((()=>[C("æˆ‘çš„æˆå°±")])),_:1})])),_:1},8,["onClick"]),k(o,{class:"menu-item",onClick:i.contactUs},{default:p((()=>[k(o,{class:"menu-icon-bg"},{default:p((()=>[k(n,{class:"menu-emoji"},{default:p((()=>[C("ðŸ“ž")])),_:1})])),_:1}),k(n,{class:"menu-text"},{default:p((()=>[C("è¯ç¹«æˆ‘å€‘")])),_:1})])),_:1},8,["onClick"]),k(o,{class:"menu-item",onClick:i.logout},{default:p((()=>[k(o,{class:"menu-icon-bg logout"},{default:p((()=>[k(n,{class:"menu-emoji"},{default:p((()=>[C("ðŸšª")])),_:1})])),_:1}),k(n,{class:"menu-text"},{default:p((()=>[C("ç™»å‡º")])),_:1})])),_:1},8,["onClick"])])),_:1})):I("",!0),k(o,{class:"section-header"},{default:p((()=>[k(n,{class:"section-title"},{default:p((()=>[C("æˆ‘çš„å‹•æ…‹")])),_:1})])),_:1}),k(u,{"scroll-y":"",class:"posts-list"},{default:p((()=>[0===l.myPosts.length?(v(),_(o,{key:0,class:"empty-state"},{default:p((()=>[k(n,null,{default:p((()=>[C("ä½ é‚„æ²’æœ‰ç™¼ä½ˆéŽå¸–å­")])),_:1})])),_:1})):(v(!0),w(U,{key:1},S(l.myPosts,(e=>(v(),_(o,{class:"post-item",key:e.id,onClick:s=>i.viewPost(e.id)},{default:p((()=>[k(n,{class:"post-title"},{default:p((()=>[C(b(e.title),1)])),_:2},1024),k(n,{class:"post-meta"},{default:p((()=>[C(b(e.categoryName||"æœªåˆ†é¡ž")+" Â· "+b(i.formatDate(e.timestamp)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),k(r,{selectedBase:4})])),_:1})}],["__scopeId","data-v-5bad73ae"]]);export{T as default};
