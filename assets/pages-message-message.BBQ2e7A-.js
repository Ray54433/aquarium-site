import{r as t,u as e,f as a,U as s,V as i,W as n,X as o,p as c,M as l,h as r,Y as d,n as f,m as u,z as m,B as p,c as h,w as _,i as v,o as b,a as g,b as y,K as k,G as I,D as U,E as C,F as D,e as N,H as x,J as T,d as w}from"./index-cizoypdI.js";import{r as $,_ as M}from"./uni-app.es.EehqqviQ.js";import{_ as j}from"./_plugin-vue_export-helper.BCo6x5W8.js";const A=j({data:()=>({activeTab:0,notifications:[],conversations:[],currentUserId:""}),onShow(){const a=t();a&&(this.currentUserId=a.id),this.loadNotifications(),this.loadConversations(),e()},onPullDownRefresh(){this.loadNotifications(),this.loadConversations(),setTimeout((()=>{a()}),1e3)},methods:{loadNotifications(){const a=t();if(a){const t=s().filter((t=>t.userId===a.id));this.notifications=t,this.notifications.sort(((t,e)=>e.timestamp-t.timestamp)),e()}else this.notifications=[],i({index:3})},async loadConversations(){if(!this.currentUserId)return;const{data:t,error:e}=await n(this.currentUserId);if(t){const e=new Map;t.forEach((t=>{const a=t.senderId===this.currentUserId,s=a?t.receiverId:t.senderId,i=a?t.receiverName:t.senderName;e.has(s)||e.set(s,{otherUserId:s,otherUserName:i,content:t.content,timestamp:t.timestamp,read:t.read})})),this.conversations=Array.from(e.values())}},handleNotificationClick(t,a){if(!t.read){this.notifications[a].read=!0;let i=s();const n=i.findIndex((e=>e.id===t.id));-1!==n&&(i[n].read=!0,o(i)),e()}t.postId&&c({url:`/pages/detail/detail?id=${t.postId}`})},openChat(t,e){c({url:`/pages/message/chat?targetUserId=${t}&targetUserName=${e}`})},confirmDelete(t,e){l({title:"åˆªé™¤å°è©±",content:`ç¢ºå®šè¦åˆªé™¤èˆ‡ ${t.otherUserName} çš„æ‰€æœ‰å°è©±å—ï¼Ÿ`,success:a=>{a.confirm&&this.performDelete(t,e)}})},async performDelete(t,e){r({title:"åˆªé™¤ä¸­..."});const{error:a}=await d(this.currentUserId,t.otherUserId);f(),a?(console.error("Delete chat error:",a),u({title:"åˆªé™¤å¤±æ•—",icon:"none"})):(this.conversations.splice(e,1),u({title:"å·²åˆªé™¤"}))},formatDate(t){if(!t)return"";let e=t;e<1e10&&(e*=1e3);const a=new Date(e);return new Date-a<864e5?`${a.getHours()}:${a.getMinutes().toString().padStart(2,"0")}`:`${a.getMonth()+1}/${a.getDate()}`},getAvatar:t=>m(t)}},[["render",function(t,e,a,s,i,n){const o=N,c=v,l=w,r=$(p("app-tab-bar"),M);return b(),h(c,{class:"container"},{default:_((()=>[g(c,{class:"notice-bar"},{default:_((()=>[g(c,{class:"notice-content"},{default:_((()=>[g(o,{class:"notice-text"},{default:_((()=>[y("ğŸ“¢ æœ¬ç‰ˆç‰ˆè¦ï¼šåš´ç¦ç™¼ä½ˆä»»ä½•è‰²æƒ…ã€æš´åŠ›ã€è³­åšåŠè©é¨™è¨Šæ¯ã€‚è«‹ä¿æŒç¦®è²Œï¼Œå°Šé‡ä»–äººã€‚é•è€…å°‡è¢«å°ç¦ã€‚")])),_:1})])),_:1})])),_:1}),g(c,{class:"header-section"},{default:_((()=>[g(c,{class:"header-content"},{default:_((()=>[g(o,{class:"page-title"},{default:_((()=>[y("æ¶ˆæ¯ä¸­å¿ƒ ğŸ””")])),_:1}),g(o,{class:"page-subtitle"},{default:_((()=>[y("æœ€æ–°çš„äº’å‹•èˆ‡æé†’")])),_:1})])),_:1})])),_:1}),g(c,{class:"tabs-container"},{default:_((()=>[g(c,{class:k(["tab-item",{active:0===i.activeTab}]),onClick:e[0]||(e[0]=t=>i.activeTab=0)},{default:_((()=>[g(o,null,{default:_((()=>[y("ç³»çµ±é€šçŸ¥")])),_:1}),0===i.activeTab?(b(),h(c,{key:0,class:"active-bar"})):I("",!0)])),_:1},8,["class"]),g(c,{class:k(["tab-item",{active:1===i.activeTab}]),onClick:e[1]||(e[1]=t=>i.activeTab=1)},{default:_((()=>[g(o,null,{default:_((()=>[y("ç§ä¿¡èŠå¤©")])),_:1}),1===i.activeTab?(b(),h(c,{key:0,class:"active-bar"})):I("",!0)])),_:1},8,["class"])])),_:1}),g(c,{class:"content-area"},{default:_((()=>[0===i.activeTab?(b(),h(c,{key:0,class:"notification-list"},{default:_((()=>[(b(!0),U(D,null,C(i.notifications,((t,e)=>(b(),h(c,{key:e,class:k(["notification-card",{unread:!t.read}]),onClick:a=>n.handleNotificationClick(t,e)},{default:_((()=>[g(c,{class:"notification-icon-wrapper"},{default:_((()=>[g(o,{class:"notification-icon"},{default:_((()=>[y(x("reply"===t.type?"ğŸ’¬":"ğŸ””"),1)])),_:2},1024)])),_:2},1024),g(c,{class:"notification-content"},{default:_((()=>[g(c,{class:"notification-header"},{default:_((()=>[g(o,{class:"notification-title"},{default:_((()=>[y(x(t.title),1)])),_:2},1024),g(o,{class:"notification-time"},{default:_((()=>[y(x(n.formatDate(t.timestamp)),1)])),_:2},1024)])),_:2},1024),g(o,{class:"notification-text"},{default:_((()=>[y(x(t.content),1)])),_:2},1024)])),_:2},1024),t.read?I("",!0):(b(),h(c,{key:0,class:"unread-dot"}))])),_:2},1032,["class","onClick"])))),128)),0===i.notifications.length?(b(),h(c,{key:0,class:"empty-state"},{default:_((()=>[g(o,{class:"empty-icon"},{default:_((()=>[y("ğŸ“­")])),_:1}),g(o,{class:"empty-text"},{default:_((()=>[y("æš«ç„¡æ–°æ¶ˆæ¯")])),_:1})])),_:1})):I("",!0)])),_:1})):I("",!0),1===i.activeTab?(b(),h(c,{key:1,class:"message-list"},{default:_((()=>[(b(!0),U(D,null,C(i.conversations,((t,e)=>(b(),h(c,{key:e,class:"notification-card",onClick:e=>n.openChat(t.otherUserId,t.otherUserName)},{default:_((()=>[g(l,{src:n.getAvatar(t.otherUserId)||"/static/logo.png",class:"notification-avatar",mode:"aspectFill"},null,8,["src"]),g(c,{class:"notification-content"},{default:_((()=>[g(c,{class:"notification-header"},{default:_((()=>[g(o,{class:"notification-title"},{default:_((()=>[y(x(t.otherUserName),1)])),_:2},1024),g(o,{class:"notification-time"},{default:_((()=>[y(x(n.formatDate(t.timestamp)),1)])),_:2},1024)])),_:2},1024),g(o,{class:"notification-text"},{default:_((()=>[y(x(t.content),1)])),_:2},1024)])),_:2},1024),g(c,{class:"delete-btn",onClick:T((a=>n.confirmDelete(t,e)),["stop"])},{default:_((()=>[g(o,{class:"delete-icon"},{default:_((()=>[y("ğŸ—‘ï¸")])),_:1})])),_:2},1032,["onClick"])])),_:2},1032,["onClick"])))),128)),0===i.conversations.length?(b(),h(c,{key:0,class:"empty-state"},{default:_((()=>[g(o,{class:"empty-icon"},{default:_((()=>[y("ğŸ’¬")])),_:1}),g(o,{class:"empty-text"},{default:_((()=>[y("æš«ç„¡ç§ä¿¡è¨˜éŒ„")])),_:1})])),_:1})):I("",!0)])),_:1})):I("",!0)])),_:1}),g(r,{selectedBase:3})])),_:1})}],["__scopeId","data-v-c0de80a6"]]);export{A as default};
