import{C as t,u as e,f as a,g as s,h as l,j as r,k as o,l as i,m as c,n,p as d,q as u,r as f,s as h,t as g,v as m,x as y,y as _,z as p,A as b,B as v,c as w,w as k,i as I,o as C,a as $,b as T,D as R,E as F,F as N,G as D,e as P,I as S,H as M,J as x,K as E,d as A}from"./index-1UdTh2kG.js";import{r as K,_ as j}from"./uni-app.es.D-AGfr41.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=L({data:()=>({categories:t||[],searchKeyword:"",recentPosts:[],myFavorites:[],loading:!1,timerInterval:null}),onLoad(){this.manualRefresh(!1),this.syncMods(),this.loadFavorites()},onShow(){e(),this.manualRefresh(!1),this.loadFavorites(),this.categories=t,this.startListTimer(),this.syncMods()},onHide(){this.timerInterval&&clearInterval(this.timerInterval)},async onPullDownRefresh(){await this.manualRefresh(),await this.syncMods(),a()},methods:{async syncMods(){await s()&&(this.categories=[...t])},async manualRefresh(t=!0){if(!this.loading){this.loading=!0,t&&l({title:"åˆ·æ–°ä¸­..."});try{const e=await r();let a=[];a=e&&Array.isArray(e)?e:o()||[],a=a.filter((t=>"business_inquiry"!==t.categoryId)),a.sort(((t,e)=>{const a=t.lastReplyTime||t.timestamp||0;return(e.lastReplyTime||e.timestamp||0)-a}));const s=a.filter((t=>"auction"===t.type));if(s.length>0){const t=s.slice(0,10).map((async t=>{try{const{data:e}=await i(t.id);if(e&&e.length>0){let a=parseFloat(t.price)||0;e.forEach((t=>{let e=0;const s=t.text.trim();if(s.includes("å‡ºåƒ¹")){const t=s.match(/(\d+)/);t&&(e=parseFloat(t[1]))}e>a&&(a=e)})),t.price=a}}catch(e){console.error("Fetch auction price error:",e)}}));await Promise.all(t)}this.recentPosts=a,t&&c({title:"å·²åˆ·æ–°",icon:"success"})}catch(e){console.error("Refresh error:",e),this.loadRecentPosts(),t&&c({title:"åˆ·æ–°å¤±æ•—ï¼Œè¼‰å…¥æœ¬åœ°æ•¸æ“š",icon:"none"})}finally{this.loading=!1,t&&n()}}},loadRecentPosts(){let t=o();t&&(t=t.filter((t=>"business_inquiry"!==t.categoryId))),t&&t.length>0?(t.sort(((t,e)=>{const a=t.lastReplyTime||t.timestamp||0;return(e.lastReplyTime||e.timestamp||0)-a})),this.recentPosts=t.slice(0,20)):this.recentPosts=[]},navigateToSubcategory(t,e){if("hall_of_fame"===t)return void d({url:"/pages/hall_of_fame/hall_of_fame"});if("all_auctions"===t)return void d({url:"/pages/category/category?type=auction&title=æ‹è³£å€"});const a=this.categories.find((e=>e.id===t));!a||a.children&&0!==a.children.length?d({url:`/pages/subcategory/subcategory?categoryId=${t}&title=${e}`}):d({url:`/pages/category/category?categoryId=${t}&title=${e}`})},handleSearch(){this.searchKeyword.trim()&&d({url:`/pages/category/category?search=${this.searchKeyword}&title=æœå°‹: ${this.searchKeyword}`})},goToDetail(t){d({url:`/pages/detail/detail?id=${t}`})},formatDate(t){if(!t)return"";const e=new Date(t<1e10?1e3*t:t),a=new Date-e;return a<864e5?a<36e5?`${Math.max(1,Math.floor(a/6e4))}åˆ†é˜å‰`:`${Math.floor(a/36e5)}å°æ™‚å‰`:`${e.getMonth()+1}/${e.getDate()}`},getCategoryDisplayName(t){if("circle"===t.categoryId)return t.subCategoryId||"å¹æ°´å»£å ´";if(t.categoryId){const e=this.categories.find((e=>e.id===t.categoryId));if(!e)return"";let a=e.name;if(t.subCategoryId&&e.children){const s=e.children.find((e=>e.id===t.subCategoryId));s&&(a+=` > ${s.name}`)}return a}return""},goToUserProfile(t){let e=t.authorId;if(!e&&t.authorName){const a=u(t.authorName);a&&(e=a.id)}if(e){const t=f();t&&String(t.id)===String(e)?h({url:"/pages/profile/profile"}):d({url:`/pages/profile/public_profile?userId=${e}`})}},getRole:t=>g(t.authorName),getBadges(t){let e=t.authorId;if(!e&&t.authorName){const a=u(t.authorName);a&&(e=a.id)}return m(e)},getLevel(t){let e=t.authorId;if(!e&&t.authorName){const a=u(t.authorName);a&&(e=a.id)}return y(e)},getPoints(t){let e=t.authorId;if(!e&&t.authorName){const a=u(t.authorName);a&&(e=a.id)}return _(e)},getAvatar(t){if(t.authorAvatar)return t.authorAvatar;let e=t.authorId;if(!e&&t.authorName){const a=u(t.authorName);a&&(e=a.id)}if(e){const t=p(e);if(t)return t}return""},startListTimer(){this.timerInterval&&clearInterval(this.timerInterval),this.timerInterval=setInterval((()=>{this.$forceUpdate()}),1e3)},isAuctionEnded(t){if(!t.auctionEndTime)return!1;return Math.floor(Date.now()/1e3)>=parseInt(t.auctionEndTime)},getCountdown(t){if(!t.auctionEndTime)return"";let e=parseInt(t.auctionEndTime)-Math.floor(Date.now()/1e3);if(e<=0)return"00:00:00";const a=Math.floor(e/3600),s=Math.floor(e%3600/60),l=e%60;return`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},loadFavorites(){const t=f();this.myFavorites=t&&b(`favorites_${t.id}`)||[]},isFavorited(t){return this.myFavorites.includes(t)}}},[["render",function(t,e,a,s,l,r){const o=I,i=P,c=S,n=A,d=K(v("app-tab-bar"),j);return C(),w(o,{class:"container"},{default:k((()=>[$(o,{class:"header-section"},{default:k((()=>[$(o,{class:"fish-container"},{default:k((()=>[$(o,{class:"css-fish"},{default:k((()=>[$(o,{class:"fish-body"},{default:k((()=>[$(o,{class:"fish-eye"}),$(o,{class:"fish-fin"})])),_:1}),$(o,{class:"fish-tail"})])),_:1})])),_:1}),$(o,{class:"header-content"},{default:k((()=>[$(i,{class:"app-title"},{default:k((()=>[T("é¦™æ¸¯æ°´æ—äº¤æµå€ ğŸ ")])),_:1}),$(o,{class:"search-bar"},{default:k((()=>[$(c,{class:"search-input",type:"text",placeholder:"æœå°‹å¸–å­...",modelValue:l.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=t=>l.searchKeyword=t),"confirm-type":"search",onConfirm:r.handleSearch},null,8,["modelValue","onConfirm"]),$(o,{class:"search-btn",onClick:r.handleSearch},{default:k((()=>[$(i,{class:"search-icon-text"},{default:k((()=>[T("GO")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),$(o,{class:"notice-bar"},{default:k((()=>[$(i,{class:"notice-text"},{default:k((()=>[T("ğŸ“¢ æœ¬ç‰ˆç‰ˆè¦ï¼šåš´ç¦ç™¼ä½ˆä»»ä½•è‰²æƒ…ã€æš´åŠ›ã€è³­åšåŠè©é¨™è¨Šæ¯ã€‚äº¤æ˜“è«‹å°å¿ƒæŸ¥è­‰ï¼Œæœ¬å°ä¸è² ä»»ä½•è²¬ä»»ã€‚è«‹ä¿æŒç¦®è²Œï¼Œäº’ç›¸å°Šé‡ï¼Œé•è€…å°è™Ÿè™•ç†ã€‚ âš ï¸")])),_:1})])),_:1})])),_:1}),$(o,{class:"content-area"},{default:k((()=>[$(o,{class:"category-grid"},{default:k((()=>[(C(!0),R(N,null,F(l.categories,(t=>(C(),w(o,{key:t.id,class:"category-item",onClick:e=>r.navigateToSubcategory(t.id,t.name)},{default:k((()=>[$(o,{class:"category-icon-bg"},{default:k((()=>[$(i,{class:"category-emoji"},{default:k((()=>[T(M(t.icon),1)])),_:2},1024)])),_:2},1024),$(i,{class:"category-name"},{default:k((()=>[T(M(t.name),1)])),_:2},1024),t.moderators&&t.moderators.length>0?(C(),w(o,{key:0,class:"moderator-tag"},{default:k((()=>[$(i,{class:"moderator-text"},{default:k((()=>[T("ç‰ˆä¸»: "+M(t.moderators.join(",")),1)])),_:2},1024)])),_:2},1024)):D("",!0)])),_:2},1032,["onClick"])))),128))])),_:1}),$(o,{class:"section-header"},{default:k((()=>[$(i,{class:"section-title"},{default:k((()=>[T("æœ€æ–°å¸–å­")])),_:1}),$(o,{class:"refresh-hint",onClick:r.manualRefresh},{default:k((()=>[$(i,null,{default:k((()=>[T("ğŸ”„ åˆ·æ–°")])),_:1})])),_:1},8,["onClick"])])),_:1}),$(o,{class:"post-list"},{default:k((()=>[(C(!0),R(N,null,F(l.recentPosts,((t,e)=>(C(),w(o,{key:e,class:"post-card",onClick:e=>r.goToDetail(t.id)},{default:k((()=>[$(o,{class:"card-header"},{default:k((()=>[$(o,{class:"author-info"},{default:k((()=>[$(n,{src:r.getAvatar(t)||"/static/logo.png",class:"post-list-avatar",mode:"aspectFill",onClick:x((e=>r.goToUserProfile(t)),["stop"])},null,8,["src","onClick"]),$(o,{class:"author-meta"},{default:k((()=>[$(o,{class:"name-row"},{default:k((()=>[$(i,{class:"author-name"},{default:k((()=>[T(M(t.authorName),1)])),_:2},1024),r.getRole(t)?(C(),w(o,{key:0,class:E(["role-badge",r.getRole(t).type])},{default:k((()=>[$(i,null,{default:k((()=>[T(M(r.getRole(t).label),1)])),_:2},1024)])),_:2},1032,["class"])):D("",!0),$(o,{class:"user-stats"},{default:k((()=>[$(i,{class:"stat-badge level"},{default:k((()=>[T("Lv."+M(r.getLevel(t)),1)])),_:2},1024),$(i,{class:"stat-badge points"},{default:k((()=>[T("ğŸ”¥"+M(r.getPoints(t)),1)])),_:2},1024)])),_:2},1024),$(o,{class:"badge-list"},{default:k((()=>[(C(!0),R(N,null,F(r.getBadges(t),((t,e)=>(C(),w(i,{key:e,class:"mini-badge"},{default:k((()=>[T(M(t.icon),1)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),$(i,{class:"post-time"},{default:k((()=>[T(M(r.formatDate(t.timestamp)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),$(o,{class:"status-container"},{default:k((()=>[t.price?(C(),w(o,{key:0,class:"price-badge"},{default:k((()=>[$(i,null,{default:k((()=>[T(M("wtb"===t.type?"é ç®—":"wts"===t.type||"auction"===t.type?"å”®":"")+" $"+M(t.price),1)])),_:2},1024)])),_:2},1024)):D("",!0),$(o,{class:"status-badges-row"},{default:k((()=>["auction"===t.type?(C(),w(o,{key:0,class:"status-badge auction"},{default:k((()=>[$(i,null,{default:k((()=>[T("ğŸ”¨ æ‹è³£")])),_:1})])),_:1})):D("",!0),"wtb"===t.type?(C(),w(o,{key:1,class:"status-badge wtb"},{default:k((()=>[$(i,null,{default:k((()=>[T("ğŸ” å¾µæ±‚")])),_:1})])),_:1})):D("",!0),"wts"===t.type?(C(),w(o,{key:2,class:"status-badge wts"},{default:k((()=>[$(i,null,{default:k((()=>[T("ğŸ’° å‡ºå”®")])),_:1})])),_:1})):D("",!0),"auction"===t.type&&t.auctionEndTime&&!r.isAuctionEnded(t)?(C(),w(o,{key:3,class:"status-badge countdown"},{default:k((()=>[$(i,null,{default:k((()=>[T("â° "+M(r.getCountdown(t)),1)])),_:2},1024)])),_:2},1024)):D("",!0),"auction"===t.type&&t.auctionEndTime&&r.isAuctionEnded(t)?(C(),w(o,{key:4,class:"status-badge ended"},{default:k((()=>[$(i,null,{default:k((()=>[T("ğŸ”´ å·²çµæŸ")])),_:1})])),_:1})):D("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024),r.getCategoryDisplayName(t)?(C(),w(o,{key:0,class:"category-tag-row"},{default:k((()=>[$(o,{class:"category-pill"},{default:k((()=>[$(i,null,{default:k((()=>[T("# "+M(r.getCategoryDisplayName(t)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):D("",!0),$(o,{class:"card-content"},{default:k((()=>[$(i,{class:"post-title"},{default:k((()=>[T(M(t.title),1)])),_:2},1024),$(i,{class:"post-desc"},{default:k((()=>[T(M(t.content.substring(0,50))+"...",1)])),_:2},1024)])),_:2},1024),t.images&&t.images.length>0?(C(),w(o,{key:1,class:"card-images"},{default:k((()=>[(C(!0),R(N,null,F(t.images.slice(0,3),((t,e)=>(C(),w(n,{key:e,src:t,mode:"aspectFill",class:"post-img"},null,8,["src"])))),128))])),_:2},1024)):t.image?(C(),w(n,{key:2,src:t.image,mode:"aspectFill",class:"post-img-single"},null,8,["src"])):D("",!0),$(o,{class:"card-footer"},{default:k((()=>[$(o,{class:"interaction-stat"},{default:k((()=>[$(i,{class:"stat-icon"},{default:k((()=>[T("â¤ï¸")])),_:1}),$(i,{class:"stat-count"},{default:k((()=>[T(M(t.likes&&t.likes.length||0),1)])),_:2},1024)])),_:2},1024),$(o,{class:"interaction-stat"},{default:k((()=>[$(i,{class:"stat-icon"},{default:k((()=>[T("ğŸ’¬")])),_:1}),$(i,{class:"stat-count"},{default:k((()=>[T(M(t.comments&&t.comments.length||0),1)])),_:2},1024)])),_:2},1024),r.isFavorited(t.id)?(C(),w(o,{key:0,class:"interaction-stat"},{default:k((()=>[$(i,{class:"stat-icon"},{default:k((()=>[T("â­")])),_:1}),$(i,{class:"stat-count"},{default:k((()=>[T("å·²æ”¶è—")])),_:1})])),_:1})):D("",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),0===l.recentPosts.length?(C(),w(o,{key:0,class:"empty-state"},{default:k((()=>[$(i,{class:"empty-icon"},{default:k((()=>[T("ğŸ“­")])),_:1}),$(i,{class:"empty-text"},{default:k((()=>[T("æš«ç„¡å¸–å­")])),_:1})])),_:1})):D("",!0)])),_:1})])),_:1}),$(d,{selectedBase:0})])),_:1})}],["__scopeId","data-v-4a993d2a"]]);export{B as default};
