import{aJ as t,R as e,k as a,g as s,P as i,t as l,aI as o,N as r,j as c,O as n,p as d,n as u,l as g,aM as f,m as h,q as p,B as m,U as y,C as _,r as I,x as b,y as k,z as C,A as v,s as T,v as $,D as P,c as N,w as S,i as M,o as F,a as w,b as D,J as A,E as R,F as x,G as E,H as L,e as j,a6 as H,K as U,L as B,d as J}from"./index-0MHUafOY.js";import{r as q,_ as z}from"./uni-app.es.CBFqqZ7o.js";import{_ as G}from"./_plugin-vue_export-helper.BCo6x5W8.js";const K=G({data:()=>({categoryId:"",pageTitle:"ÂàÜÈ°û",subcategories:[],posts:[],myFavorites:[]}),computed:{currentModerators(){if(!this.categoryId)return[];const e=t(this.categoryId);return e&&e.moderators||[]},isCircleTopic(){return"circle_topic"===this.categoryId||this.pageTitle&&this.pageTitle.includes("ÂêπÊ∞¥")||this.categoryId&&this.categoryId.startsWith("circle")},canHaveAuction:()=>!0},onLoad(t){this.categoryId=t.categoryId||"",this.parentId=t.parentId||"",t.title&&(this.pageTitle=t.title,e({title:t.title})),this.loadSubcategories()},onShow(){this.refreshRole(),this.loadPosts(),this.loadFavorites(),this.startListTimer()},onHide(){this.timerInterval&&clearInterval(this.timerInterval)},async onPullDownRefresh(){try{await a()&&this.loadPosts()}catch(t){console.error("Subcategory refresh error:",t)}finally{setTimeout((()=>{s()}),500)}},methods:{refreshRole(){this.checkModStatus(),i().then((()=>{this.checkModStatus()}))},checkModStatus(){const t=l();this.isMod=o(t,this.categoryId)},async togglePin(t){const e=!t.isPinned,a=e?"ÁΩÆÈ†Ç":"ÂèñÊ∂àÁΩÆÈ†Ç";r({title:"ÁÆ°ÁêÜÂì°Êìç‰Ωú",content:`Á¢∫ÂÆöË¶Å${a}Ê≠§Â∏ñÂ≠êÂóéÔºü`,success:async s=>{if(s.confirm)try{c({title:"ËôïÁêÜ‰∏≠..."}),await n(t.id,{isPinned:e}),t.isPinned=e,this.loadPosts(),d(),u({title:`Â∑≤${a}`})}catch(i){console.error("Pin error:",i),d(),u({title:"Êìç‰ΩúÂ§±Êïó",icon:"none"})}}})},loadSubcategories(){const e=t(this.categoryId);e&&e.children&&(this.subcategories=e.children)},async loadPosts(){if(this.isCircleTopic){let t="";this.pageTitle&&(t=this.pageTitle.replace(" üìÇ","").trim());const e=g();this.posts=e.filter((e=>"circle"===e.categoryId&&e.subCategoryId===t))}else this.posts=f(this.categoryId);this.posts.sort(((t,e)=>t.isPinned&&!e.isPinned?-1:!t.isPinned&&e.isPinned?1:(e.timestamp||0)-(t.timestamp||0)));const t=this.posts.filter((t=>"auction"===t.type));t.length>0&&t.map((async t=>{try{const{data:e}=await h(t.id);if(e&&e.length>0){let a=parseFloat(t.price)||0;e.forEach((t=>{let e=0;const s=t.text.trim();if(s.includes("Âá∫ÂÉπ")){const t=s.match(/(\d+)/);t&&(e=parseFloat(t[1]))}e>a&&(a=e)})),t.price=a}}catch(e){console.error("Fetch auction price error:",e)}}))},navigateToCategory(t,e,a){const s=this.subcategories.find((t=>t.id===e));if(s&&s.children&&s.children.length>0)p({url:`/pages/subcategory/subcategory?categoryId=${e}&title=${a}&parentId=${t}`});else{let s=t,i=e,l="";this.parentId?(s=this.parentId,i=t,l=e,p({url:`/pages/category/category?categoryId=${s}&subCategoryId=${i}&detailCategoryId=${l}&title=${a}`})):p({url:`/pages/category/category?categoryId=${s}&subCategoryId=${i}&title=${a}`})}},goToDetail(t){p({url:`/pages/detail/detail?id=${t}`})},createPost(){if(!m("currentUser"))return u({title:"Ë´ãÂÖàÁôªÂÖ•",icon:"none"}),void setTimeout((()=>{p({url:"/pages/login/login"})}),1e3);if(this.isCircleTopic)p({url:`/pages/create/create?mode=circle&topic=${this.pageTitle.replace(" üìÇ","")}`});else{let t={};t=this.parentId?{categoryId:this.parentId,subCategoryId:this.categoryId}:{categoryId:this.categoryId},y("preSelectCategory",t),p({url:"/pages/create/create"})}},goToAuctions(){p({url:`/pages/category/category?type=auction&title=ÊãçË≥£ÂçÄ&filter=${this.categoryId}`})},formatDate(t){if(!t)return"";const e=new Date(t<1e10?1e3*t:t);return isNaN(e.getTime())?"":`${e.getMonth()+1}/${e.getDate()} ${e.getHours()}:${e.getMinutes().toString().padStart(2,"0")}`},getCategoryName(t){if(!t.categoryId)return"";if("circle"===t.categoryId)return t.subCategoryId||"ÂêπÊ∞¥Âª£Â†¥";const e=_.find((e=>e.id===t.categoryId));if(!e)return"";if(t.subCategoryId&&e.children){const a=e.children.find((e=>e.id===t.subCategoryId));return a?`${e.name} - ${a.name}`:e.name}return e.name},getBadges(t){let e=t.authorId;if(!e&&t.authorName){const a=I(t.authorName);a&&(e=a.id)}return b(e)},getLevel(t){let e=t.authorId;if(!e&&t.authorName){const a=I(t.authorName);a&&(e=a.id)}return k(e)},getPoints(t){let e=t.authorId;if(!e&&t.authorName){const a=I(t.authorName);a&&(e=a.id)}return C(e)},getAvatar(t){let e=t.authorId;if(!e&&t.authorName){const a=I(t.authorName);a&&(e=a.id)}return v(e)},goToUserProfile(t){let e=t.authorId;if(!e&&t.authorName){const a=I(t.authorName);a&&(e=a.id)}if(e){const t=l();t&&String(t.id)===String(e)?T({url:"/pages/profile/profile"}):p({url:`/pages/profile/public_profile?userId=${e}`})}},getRole:t=>$(t.authorName),startListTimer(){this.timerInterval&&clearInterval(this.timerInterval),this.timerInterval=setInterval((()=>{this.$forceUpdate()}),1e3)},isAuctionEnded(t){if(!t.auctionEndTime)return!1;return Math.floor(Date.now()/1e3)>=parseInt(t.auctionEndTime)},getCountdown(t){if(!t.auctionEndTime)return"";let e=parseInt(t.auctionEndTime)-Math.floor(Date.now()/1e3);if(e<=0)return"00:00:00";const a=Math.floor(e/3600),s=Math.floor(e%3600/60),i=e%60;return`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},loadFavorites(){const t=l();this.myFavorites=t&&m(`favorites_${t.id}`)||[]},isFavorited(t){return this.myFavorites.includes(t)}}},[["render",function(t,e,a,s,i,l){const o=j,r=M,c=J,n=H,d=q(P("app-tab-bar"),z);return F(),N(r,{class:"container"},{default:S((()=>[w(r,{class:"header-section"},{default:S((()=>[w(r,{class:"header-content"},{default:S((()=>[w(o,{class:"page-title"},{default:S((()=>[D(A(i.pageTitle)+" üìÇ",1)])),_:1}),w(o,{class:"page-subtitle"},{default:S((()=>[D("Êé¢Á¥¢Êõ¥Â§öÁ≤æÂΩ©ÂÖßÂÆπ")])),_:1})])),_:1})])),_:1}),l.currentModerators&&l.currentModerators.length>0?(F(),N(r,{key:0,class:"moderator-header"},{default:S((()=>[w(o,{class:"mod-label"},{default:S((()=>[D("Áâà‰∏ªÔºö")])),_:1}),w(r,{class:"mod-list"},{default:S((()=>[(F(!0),R(E,null,x(l.currentModerators,((t,e)=>(F(),N(r,{key:e,class:"mod-badge"},{default:S((()=>[w(o,null,{default:S((()=>[D(A(t),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):L("",!0),l.isCircleTopic?L("",!0):(F(),N(r,{key:1,class:"notice-bar-container"},{default:S((()=>[w(r,{class:"notice-bar"},{default:S((()=>[w(r,{class:"notice-content"},{default:S((()=>[w(o,{class:"notice-text"},{default:S((()=>[D("üì¢ Êú¨ÁâàÁâàË¶èÔºöÂö¥Á¶ÅÁôº‰Ωà‰ªª‰ΩïËâ≤ÊÉÖ„ÄÅÊö¥Âäõ„ÄÅË≥≠ÂçöÂèäË©êÈ®ôË®äÊÅØ„ÄÇË´ã‰øùÊåÅÁ¶ÆË≤åÔºåÂ∞äÈáç‰ªñ‰∫∫„ÄÇÈÅïËÄÖÂ∞áË¢´Â∞ÅÁ¶Å„ÄÇ")])),_:1})])),_:1})])),_:1})])),_:1})),w(r,{class:"content-area"},{default:S((()=>[i.subcategories.length>0?(F(),N(r,{key:0,class:"grid-card"},{default:S((()=>[w(r,{class:"subcategory-grid"},{default:S((()=>[(F(!0),R(E,null,x(i.subcategories,(t=>(F(),N(r,{key:t.id,class:"subcategory-item",onClick:e=>l.navigateToCategory(i.categoryId,t.id,t.name)},{default:S((()=>[w(r,{class:"icon-circle"},{default:S((()=>[t.icon&&(t.icon.includes("/")||t.icon.includes("http"))?(F(),N(c,{key:0,src:t.icon,class:"subcategory-img",mode:"aspectFit"},null,8,["src"])):(F(),N(o,{key:1,class:"subcategory-emoji"},{default:S((()=>[D(A(t.icon||"üì¶"),1)])),_:2},1024))])),_:2},1024),w(o,{class:"subcategory-name"},{default:S((()=>[D(A(t.name),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):L("",!0),l.canHaveAuction&&!l.isCircleTopic?(F(),N(r,{key:1,class:"action-btn-container"},{default:S((()=>[w(n,{class:"auction-btn",onClick:l.goToAuctions},{default:S((()=>[w(o,null,{default:S((()=>[D("Êü•ÁúãÊú¨ÂçÄÊãçË≥£ üî®")])),_:1})])),_:1},8,["onClick"])])),_:1})):L("",!0),w(r,{class:"post-section"},{default:S((()=>[w(r,{class:"section-title-row"},{default:S((()=>[w(o,{class:"section-title"},{default:S((()=>[D("ÊúÄÊñ∞Â∏ñÂ≠ê")])),_:1})])),_:1}),w(r,{class:"post-list"},{default:S((()=>[(F(!0),R(E,null,x(i.posts,((e,a)=>(F(),N(r,{key:a,class:"post-card",onClick:t=>l.goToDetail(e.id)},{default:S((()=>[w(r,{class:"card-header"},{default:S((()=>[w(r,{class:"author-info"},{default:S((()=>[w(c,{src:l.getAvatar(e)||"/static/logo.png",class:"post-list-avatar",mode:"aspectFill",onClick:U((t=>l.goToUserProfile(e)),["stop"])},null,8,["src","onClick"]),w(r,{class:"author-meta"},{default:S((()=>[w(r,{class:"name-row"},{default:S((()=>[w(o,{class:"author-name"},{default:S((()=>[D(A(e.authorName),1)])),_:2},1024),l.getRole(e)?(F(),N(r,{key:0,class:B(["role-badge",l.getRole(e).type])},{default:S((()=>[w(o,null,{default:S((()=>[D(A(l.getRole(e).label),1)])),_:2},1024)])),_:2},1032,["class"])):L("",!0),w(r,{class:"user-stats"},{default:S((()=>[w(o,{class:"stat-badge level"},{default:S((()=>[D("Lv."+A(l.getLevel(e)),1)])),_:2},1024),w(o,{class:"stat-badge points"},{default:S((()=>[D("üî•"+A(l.getPoints(e)),1)])),_:2},1024)])),_:2},1024),w(r,{class:"badge-list"},{default:S((()=>[(F(!0),R(E,null,x(l.getBadges(e),((t,e)=>(F(),N(o,{key:e,class:"mini-badge"},{default:S((()=>[D(A(t.icon),1)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),w(o,{class:"post-time"},{default:S((()=>[D(A(l.formatDate(e.timestamp)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),w(r,{class:"header-right-actions"},{default:S((()=>["auction"===e.type?(F(),N(r,{key:0,class:"auction-badge"},{default:S((()=>[w(o,null,{default:S((()=>[D("üî® $"+A(e.price),1)])),_:2},1024)])),_:2},1024)):L("",!0),e.isPinned?(F(),N(r,{key:1,class:"pin-badge"},{default:S((()=>[w(o,null,{default:S((()=>[D("üìå ÁΩÆÈ†Ç")])),_:1})])),_:1})):L("",!0),t.isMod?(F(),N(r,{key:2,class:"admin-pin-btn",onClick:U((t=>l.togglePin(e)),["stop"])},{default:S((()=>[w(o,null,{default:S((()=>[D(A(e.isPinned?"ÂèñÊ∂àÁΩÆÈ†Ç":"ÁΩÆÈ†Ç"),1)])),_:2},1024)])),_:2},1032,["onClick"])):L("",!0)])),_:2},1024)])),_:2},1024),l.getCategoryName(e)?(F(),N(r,{key:0,class:"category-tag-row"},{default:S((()=>[w(r,{class:"category-pill"},{default:S((()=>[w(o,null,{default:S((()=>[D("# "+A(l.getCategoryName(e)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):L("",!0),w(r,{class:"card-content"},{default:S((()=>[w(o,{class:"post-title"},{default:S((()=>[D(A(e.title),1)])),_:2},1024),w(o,{class:"post-desc"},{default:S((()=>[D(A(e.content.substring(0,50))+"...",1)])),_:2},1024)])),_:2},1024),e.images&&e.images.length>0?(F(),N(r,{key:1,class:"card-images"},{default:S((()=>[(F(!0),R(E,null,x(e.images.slice(0,3),((t,e)=>(F(),N(c,{key:e,src:t,mode:"aspectFill",class:"post-img"},null,8,["src"])))),128))])),_:2},1024)):e.image?(F(),N(c,{key:2,src:e.image,mode:"aspectFill",class:"post-img-single"},null,8,["src"])):L("",!0),w(r,{class:"card-footer"},{default:S((()=>[w(r,{class:"interaction-stat"},{default:S((()=>[w(o,{class:"stat-icon"},{default:S((()=>[D("‚ù§Ô∏è")])),_:1}),w(o,{class:"stat-count"},{default:S((()=>[D(A(e.likes&&e.likes.length||0),1)])),_:2},1024)])),_:2},1024),w(r,{class:"interaction-stat"},{default:S((()=>[w(o,{class:"stat-icon"},{default:S((()=>[D("üí¨")])),_:1}),w(o,{class:"stat-count"},{default:S((()=>[D(A(e.comments&&e.comments.length||0),1)])),_:2},1024)])),_:2},1024),l.isFavorited(e.id)?(F(),N(r,{key:0,class:"interaction-stat"},{default:S((()=>[w(o,{class:"stat-icon"},{default:S((()=>[D("‚≠ê")])),_:1}),w(o,{class:"stat-count"},{default:S((()=>[D("Â∑≤Êî∂Ëóè")])),_:1})])),_:1})):L("",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),0===i.posts.length?(F(),N(r,{key:0,class:"empty-state"},{default:S((()=>[w(o,{class:"empty-icon"},{default:S((()=>[D("üì≠")])),_:1}),w(o,{class:"empty-text"},{default:S((()=>[D("Êö´ÁÑ°Â∏ñÂ≠ê")])),_:1})])),_:1})):L("",!0)])),_:1})])),_:1})])),_:1}),w(r,{class:"fab",onClick:l.createPost},{default:S((()=>[w(o,{class:"fab-icon"},{default:S((()=>[D("‚ûï")])),_:1})])),_:1},8,["onClick"]),w(d)])),_:1})}],["__scopeId","data-v-ae2d037c"]]);export{K as default};
