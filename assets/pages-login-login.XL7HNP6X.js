import{n as e,j as s,ao as i,p as a,ap as t,aq as l,ar as o,as as r,N as n,B as c,U as d,ak as u,ai as p,s as f,c as m,w as h,i as g,o as y,a as _,b as v,J as w,H as V,d as k,e as C,I as U,a6 as I}from"./index-BurITbpl.js";import{_ as b}from"./logo.CtHxZGvc.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const R=x({data:()=>({isRegister:!1,isVerifying:!1,email:"",password:"",verificationCode:"",tempUserId:"",useBackend:!0}),methods:{toggleMode(){this.isRegister=!this.isRegister,this.email="",this.password=""},cancelVerification(){this.isVerifying=!1,this.verificationCode="",this.tempUserId=""},async handleSubmit(){this.email&&this.password?this.isRegister?await this.register():await this.login():e({title:"è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½",icon:"none"})},async register(){if(this.useBackend){s({title:"è™•ç†ä¸­..."});const{data:o,error:r}=await i(this.email,this.password);if(r)return a(),void e({title:r.message||"è¨»å†Šå¤±æ•—",icon:"none"});if(o&&o.user){this.tempUserId=o.user.$id;const{error:s}=await t(this.tempUserId,this.email);a(),s?e({title:"é©—è­‰ç¢¼ç™¼é€å¤±æ•—ï¼Œè«‹é‡è©¦",icon:"none"}):(e({title:"é©—è­‰ç¢¼å·²ç™¼é€",icon:"success"}),this.isVerifying=!0,await l())}}else e({title:"è«‹å•Ÿç”¨å¾Œç«¯æœå‹™",icon:"none"})},async handleVerification(){if(!this.verificationCode)return void e({title:"è«‹è¼¸å…¥é©—è­‰ç¢¼",icon:"none"});s({title:"é©—è­‰ä¸­..."});const{data:i,error:t}=await o(this.tempUserId,this.verificationCode);if(a(),t)e({title:"é©—è­‰å¤±æ•—: "+(t.message||"é©—è­‰ç¢¼éŒ¯èª¤"),icon:"none"});else if(i&&i.session){e({title:"é©—è­‰æˆåŠŸ",icon:"success"});const s={id:i.user.$id,email:i.user.email,name:i.user.name||i.user.email.split("@")[0],avatar:i.user.prefs&&i.user.prefs.avatar?i.user.prefs.avatar:"",loginType:"email"};this.completeLogin(s)}},async login(){if(this.useBackend){s({title:"ç™»å…¥ä¸­..."});const{data:i,error:o}=await r(this.email,this.password);if(a(),o)return void e({title:"ç™»å…¥å¤±æ•—: "+(o.message||"æœªçŸ¥éŒ¯èª¤"),icon:"none"});if(i.user){if(!1===i.user.emailVerification)return void n({title:"å¸³è™Ÿæœªé©—è­‰",content:"æ‚¨çš„å¸³è™Ÿå°šæœªå®Œæˆéƒµç®±é©—è­‰ï¼Œæ˜¯å¦ç¾åœ¨é©—è­‰ï¼Ÿ",success:async o=>{if(o.confirm){this.tempUserId=i.user.$id,s({title:"ç™¼é€é©—è­‰ç¢¼..."});const{error:o}=await t(this.tempUserId,this.email);a(),o?e({title:"ç™¼é€å¤±æ•—",icon:"none"}):(this.isVerifying=!0,await l())}else await l()}});const o={id:i.user.$id,email:i.user.email,name:i.user.name||i.user.email.split("@")[0],avatar:i.user.prefs&&i.user.prefs.avatar?i.user.prefs.avatar:"",loginType:"email"};this.completeLogin(o)}}else e({title:"è«‹å•Ÿç”¨å¾Œç«¯æœå‹™",icon:"none"})},async completeLogin(s,i=-1,a=null){a||(i=(a=c("users")||[]).findIndex((e=>e.id===s.id||s.email&&e.email===s.email)));const t=Date.now();s.loginHistory||(s.loginHistory=[]),s.loginHistory.push(t);const l=t-6048e5;s.loginHistory=s.loginHistory.filter((e=>e>l)),-1!==i?a[i]={...a[i],...s}:a.push(s),d("users",a),d("currentUser",-1!==i?a[i]:s),await u(),e({title:"ç™»å…¥æˆåŠŸ"}),p("userSignedIn",s),setTimeout((()=>{f({url:"/pages/home/home"})}),1e3)}}},[["render",function(e,s,i,a,t,l){const o=g,r=k,n=C,c=U,d=I;return y(),m(o,{class:"container"},{default:h((()=>[_(o,{class:"header-bg"}),_(o,{class:"content-wrapper"},{default:h((()=>[_(o,{class:"logo-area"},{default:h((()=>[_(r,{class:"logo",src:b,mode:"aspectFit"}),_(n,{class:"app-title"},{default:h((()=>[v("é¦™æ¸¯æ°´æ—äº¤æµå€")])),_:1}),_(n,{class:"app-subtitle"},{default:h((()=>[v("é€£æŽ¥å…¨æ¸¯æ°´æ—æ„›å¥½è€…")])),_:1})])),_:1}),_(o,{class:"form-card"},{default:h((()=>[_(n,{class:"form-title"},{default:h((()=>[v(w(t.isVerifying?"é©—è­‰éƒµç®±":t.isRegister?"è¨»å†Šå¸³è™Ÿ":"æ­¡è¿Žç™»å…¥"),1)])),_:1}),t.isVerifying?(y(),m(o,{key:1},{default:h((()=>[_(n,{class:"verify-hint"},{default:h((()=>[v("é©—è­‰ç¢¼å·²ç™¼é€è‡³ "+w(t.email),1)])),_:1}),_(o,{class:"input-group"},{default:h((()=>[_(n,{class:"input-icon"},{default:h((()=>[v("ðŸ”¢")])),_:1}),_(c,{class:"input",type:"text",modelValue:t.verificationCode,"onUpdate:modelValue":s[2]||(s[2]=e=>t.verificationCode=e),placeholder:"è«‹è¼¸å…¥6ä½é©—è­‰ç¢¼","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),_(d,{class:"btn-primary",onClick:l.handleVerification,"hover-class":"btn-hover"},{default:h((()=>[v("æäº¤é©—è­‰")])),_:1},8,["onClick"]),_(o,{class:"toggle-area",onClick:l.cancelVerification},{default:h((()=>[_(n,{class:"toggle-text"},{default:h((()=>[v("è¿”å›žä¿®æ”¹éƒµç®±")])),_:1})])),_:1},8,["onClick"])])),_:1})):(y(),m(o,{key:0},{default:h((()=>[_(o,{class:"input-group"},{default:h((()=>[_(n,{class:"input-icon"},{default:h((()=>[v("ðŸ“§")])),_:1}),_(c,{class:"input",type:"text",modelValue:t.email,"onUpdate:modelValue":s[0]||(s[0]=e=>t.email=e),placeholder:"é›»å­éƒµä»¶","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),_(o,{class:"input-group"},{default:h((()=>[_(n,{class:"input-icon"},{default:h((()=>[v("ðŸ”’")])),_:1}),_(c,{class:"input",type:"password",modelValue:t.password,"onUpdate:modelValue":s[1]||(s[1]=e=>t.password=e),placeholder:"å¯†ç¢¼","placeholder-class":"placeholder"},null,8,["modelValue"])])),_:1}),_(d,{class:"btn-primary",onClick:l.handleSubmit,"hover-class":"btn-hover"},{default:h((()=>[v(w(t.isRegister?"è¨»å†Šä¸¦é©—è­‰":"ç™»å…¥"),1)])),_:1},8,["onClick"])])),_:1})),t.isVerifying?V("",!0):(y(),m(o,{key:2,class:"toggle-area",onClick:l.toggleMode},{default:h((()=>[_(n,{class:"toggle-text"},{default:h((()=>[v(w(t.isRegister?"å·²æœ‰å¸³è™Ÿï¼ŸåŽ»ç™»å…¥":"æ²’æœ‰å¸³è™Ÿï¼ŸåŽ»è¨»å†Š"),1)])),_:1})])),_:1},8,["onClick"]))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-966f1a0f"]]);export{R as default};
