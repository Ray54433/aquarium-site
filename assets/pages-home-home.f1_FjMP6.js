import{C as t,u as e,f as a,g as s,h as l,j as r,k as o,l as i,m as c,n,p as d,q as u,r as f,t as h,s as g,v as m,x as y,y as _,z as p,A as b,B as v,D as w,c as k,w as I,i as C,o as $,a as T,b as R,E as F,F as N,G as D,H as P,e as S,I as M,J as x,K as E,L as A,d as K}from"./index-BurITbpl.js";import{r as L,_ as j}from"./uni-app.es.DTb5EvbE.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";const U=B({data:()=>({categories:t||[],searchKeyword:"",recentPosts:[],myFavorites:[],loading:!1,timerInterval:null}),onLoad(){this.manualRefresh(!1),this.syncMods(),this.loadFavorites()},onShow(){e(),this.manualRefresh(!1),this.loadFavorites(),this.categories=t,this.startListTimer(),this.syncMods(),a()},onHide(){this.timerInterval&&clearInterval(this.timerInterval)},async onPullDownRefresh(){await this.manualRefresh(),await this.syncMods(),s()},methods:{async syncMods(){await l()&&(this.categories=[...t])},async manualRefresh(t=!0){if(!this.loading){this.loading=!0,t&&r({title:"åˆ·æ–°ä¸­..."});try{const e=await o();let a=[];a=e&&Array.isArray(e)?e:i()||[],a=a.filter((t=>"business_inquiry"!==t.categoryId)),a.sort(((t,e)=>{const a=t.lastReplyTime||t.timestamp||0;return(e.lastReplyTime||e.timestamp||0)-a}));const s=a.filter((t=>"auction"===t.type));if(s.length>0){const t=s.slice(0,10).map((async t=>{try{const{data:e}=await c(t.id);if(e&&e.length>0){let a=parseFloat(t.price)||0;e.forEach((t=>{let e=0;const s=t.text.trim();if(s.includes("å‡ºåƒ¹")){const t=s.match(/(\d+)/);t&&(e=parseFloat(t[1]))}e>a&&(a=e)})),t.price=a}}catch(e){console.error("Fetch auction price error:",e)}}));await Promise.all(t)}this.recentPosts=a,t&&n({title:"å·²åˆ·æ–°",icon:"success"})}catch(e){console.error("Refresh error:",e),this.loadRecentPosts(),t&&n({title:"åˆ·æ–°å¤±æ•—ï¼Œè¼‰å…¥æœ¬åœ°æ•¸æ“š",icon:"none"})}finally{this.loading=!1,t&&d()}}},loadRecentPosts(){let t=i();t&&(t=t.filter((t=>"business_inquiry"!==t.categoryId))),t&&t.length>0?(t.sort(((t,e)=>{const a=t.lastReplyTime||t.timestamp||0;return(e.lastReplyTime||e.timestamp||0)-a})),this.recentPosts=t.slice(0,20)):this.recentPosts=[]},navigateToSubcategory(t,e){if("hall_of_fame"===t)return void u({url:"/pages/hall_of_fame/hall_of_fame"});if("all_auctions"===t)return void u({url:"/pages/category/category?type=auction&title=æ‹è³£å€"});const a=this.categories.find((e=>e.id===t));!a||a.children&&0!==a.children.length?u({url:`/pages/subcategory/subcategory?categoryId=${t}&title=${e}`}):u({url:`/pages/category/category?categoryId=${t}&title=${e}`})},handleSearch(){this.searchKeyword.trim()&&u({url:`/pages/category/category?search=${this.searchKeyword}&title=æœå°‹: ${this.searchKeyword}`})},goToDetail(t){u({url:`/pages/detail/detail?id=${t}`})},formatDate(t){if(!t)return"";const e=new Date(t<1e10?1e3*t:t),a=new Date-e;return a<864e5?a<36e5?`${Math.max(1,Math.floor(a/6e4))}åˆ†é˜å‰`:`${Math.floor(a/36e5)}å°æ™‚å‰`:`${e.getMonth()+1}/${e.getDate()}`},getCategoryDisplayName(t){if("circle"===t.categoryId)return t.subCategoryId||"å¹æ°´å»£å ´";if(t.categoryId){const e=this.categories.find((e=>e.id===t.categoryId));if(!e)return"";let a=e.name;if(t.subCategoryId&&e.children){const s=e.children.find((e=>e.id===t.subCategoryId));s&&(a+=` > ${s.name}`)}return a}return""},goToUserProfile(t){let e=t.authorId;if(!e&&t.authorName){const a=f(t.authorName);a&&(e=a.id)}if(e){const t=h();t&&String(t.id)===String(e)?g({url:"/pages/profile/profile"}):u({url:`/pages/profile/public_profile?userId=${e}`})}},getRole:t=>m(t.authorName),getBadges(t){let e=t.authorId;if(!e&&t.authorName){const a=f(t.authorName);a&&(e=a.id)}return y(e)},getLevel(t){let e=t.authorId;if(!e&&t.authorName){const a=f(t.authorName);a&&(e=a.id)}return _(e)},getPoints(t){let e=t.authorId;if(!e&&t.authorName){const a=f(t.authorName);a&&(e=a.id)}return p(e)},getAvatar(t){if(t.authorAvatar)return t.authorAvatar;let e=t.authorId;if(!e&&t.authorName){const a=f(t.authorName);a&&(e=a.id)}if(e){const t=b(e);if(t)return t}return""},startListTimer(){this.timerInterval&&clearInterval(this.timerInterval),this.timerInterval=setInterval((()=>{this.$forceUpdate()}),1e3)},isAuctionEnded(t){if(!t.auctionEndTime)return!1;return Math.floor(Date.now()/1e3)>=parseInt(t.auctionEndTime)},getCountdown(t){if(!t.auctionEndTime)return"";let e=parseInt(t.auctionEndTime)-Math.floor(Date.now()/1e3);if(e<=0)return"00:00:00";const a=Math.floor(e/3600),s=Math.floor(e%3600/60),l=e%60;return`${a.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},loadFavorites(){const t=h();this.myFavorites=t&&v(`favorites_${t.id}`)||[]},isFavorited(t){return this.myFavorites.includes(t)}}},[["render",function(t,e,a,s,l,r){const o=C,i=S,c=M,n=K,d=L(w("app-tab-bar"),j);return $(),k(o,{class:"container"},{default:I((()=>[T(o,{class:"header-section"},{default:I((()=>[T(o,{class:"fish-container"},{default:I((()=>[T(o,{class:"css-fish"},{default:I((()=>[T(o,{class:"fish-body"},{default:I((()=>[T(o,{class:"fish-eye"}),T(o,{class:"fish-fin"})])),_:1}),T(o,{class:"fish-tail"})])),_:1})])),_:1}),T(o,{class:"header-content"},{default:I((()=>[T(i,{class:"app-title"},{default:I((()=>[R("é¦™æ¸¯æ°´æ—äº¤æµå€ ğŸ ")])),_:1}),T(o,{class:"search-bar"},{default:I((()=>[T(c,{class:"search-input",type:"text",placeholder:"æœå°‹å¸–å­...",modelValue:l.searchKeyword,"onUpdate:modelValue":e[0]||(e[0]=t=>l.searchKeyword=t),"confirm-type":"search",onConfirm:r.handleSearch},null,8,["modelValue","onConfirm"]),T(o,{class:"search-btn",onClick:r.handleSearch},{default:I((()=>[T(i,{class:"search-icon-text"},{default:I((()=>[R("GO")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1}),T(o,{class:"notice-bar"},{default:I((()=>[T(i,{class:"notice-text"},{default:I((()=>[R("ğŸ“¢ æœ¬ç‰ˆç‰ˆè¦ï¼šåš´ç¦ç™¼ä½ˆä»»ä½•è‰²æƒ…ã€æš´åŠ›ã€è³­åšåŠè©é¨™è¨Šæ¯ã€‚äº¤æ˜“è«‹å°å¿ƒæŸ¥è­‰ï¼Œæœ¬å°ä¸è² ä»»ä½•è²¬ä»»ã€‚è«‹ä¿æŒç¦®è²Œï¼Œäº’ç›¸å°Šé‡ï¼Œé•è€…å°è™Ÿè™•ç†ã€‚ âš ï¸")])),_:1})])),_:1})])),_:1}),T(o,{class:"content-area"},{default:I((()=>[T(o,{class:"category-grid"},{default:I((()=>[($(!0),F(D,null,N(l.categories,(t=>($(),k(o,{key:t.id,class:"category-item",onClick:e=>r.navigateToSubcategory(t.id,t.name)},{default:I((()=>[T(o,{class:"category-icon-bg"},{default:I((()=>[T(i,{class:"category-emoji"},{default:I((()=>[R(x(t.icon),1)])),_:2},1024)])),_:2},1024),T(i,{class:"category-name"},{default:I((()=>[R(x(t.name),1)])),_:2},1024),t.moderators&&t.moderators.length>0?($(),k(o,{key:0,class:"moderator-tag"},{default:I((()=>[T(i,{class:"moderator-text"},{default:I((()=>[R("ç‰ˆä¸»: "+x(t.moderators.join(",")),1)])),_:2},1024)])),_:2},1024)):P("",!0)])),_:2},1032,["onClick"])))),128))])),_:1}),T(o,{class:"section-header"},{default:I((()=>[T(i,{class:"section-title"},{default:I((()=>[R("æœ€æ–°å¸–å­")])),_:1}),T(o,{class:"refresh-hint",onClick:r.manualRefresh},{default:I((()=>[T(i,null,{default:I((()=>[R("ğŸ”„ åˆ·æ–°")])),_:1})])),_:1},8,["onClick"])])),_:1}),T(o,{class:"post-list"},{default:I((()=>[($(!0),F(D,null,N(l.recentPosts,((t,e)=>($(),k(o,{key:e,class:"post-card",onClick:e=>r.goToDetail(t.id)},{default:I((()=>[T(o,{class:"card-header"},{default:I((()=>[T(o,{class:"author-info"},{default:I((()=>[T(n,{src:r.getAvatar(t)||"/static/logo.png",class:"post-list-avatar",mode:"aspectFill",onClick:E((e=>r.goToUserProfile(t)),["stop"])},null,8,["src","onClick"]),T(o,{class:"author-meta"},{default:I((()=>[T(o,{class:"name-row"},{default:I((()=>[T(i,{class:"author-name"},{default:I((()=>[R(x(t.authorName),1)])),_:2},1024),r.getRole(t)?($(),k(o,{key:0,class:A(["role-badge",r.getRole(t).type])},{default:I((()=>[T(i,null,{default:I((()=>[R(x(r.getRole(t).label),1)])),_:2},1024)])),_:2},1032,["class"])):P("",!0),T(o,{class:"user-stats"},{default:I((()=>[T(i,{class:"stat-badge level"},{default:I((()=>[R("Lv."+x(r.getLevel(t)),1)])),_:2},1024),T(i,{class:"stat-badge points"},{default:I((()=>[R("ğŸ”¥"+x(r.getPoints(t)),1)])),_:2},1024)])),_:2},1024),T(o,{class:"badge-list"},{default:I((()=>[($(!0),F(D,null,N(r.getBadges(t),((t,e)=>($(),k(i,{key:e,class:"mini-badge"},{default:I((()=>[R(x(t.icon),1)])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024),T(i,{class:"post-time"},{default:I((()=>[R(x(r.formatDate(t.timestamp)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),T(o,{class:"status-container"},{default:I((()=>[t.price?($(),k(o,{key:0,class:"price-badge"},{default:I((()=>[T(i,null,{default:I((()=>[R(x("wtb"===t.type?"é ç®—":"wts"===t.type||"auction"===t.type?"å”®":"")+" $"+x(t.price),1)])),_:2},1024)])),_:2},1024)):P("",!0),T(o,{class:"status-badges-row"},{default:I((()=>["auction"===t.type?($(),k(o,{key:0,class:"status-badge auction"},{default:I((()=>[T(i,null,{default:I((()=>[R("ğŸ”¨ æ‹è³£")])),_:1})])),_:1})):P("",!0),"wtb"===t.type?($(),k(o,{key:1,class:"status-badge wtb"},{default:I((()=>[T(i,null,{default:I((()=>[R("ğŸ” å¾µæ±‚")])),_:1})])),_:1})):P("",!0),"wts"===t.type?($(),k(o,{key:2,class:"status-badge wts"},{default:I((()=>[T(i,null,{default:I((()=>[R("ğŸ’° å‡ºå”®")])),_:1})])),_:1})):P("",!0),"auction"===t.type&&t.auctionEndTime&&!r.isAuctionEnded(t)?($(),k(o,{key:3,class:"status-badge countdown"},{default:I((()=>[T(i,null,{default:I((()=>[R("â° "+x(r.getCountdown(t)),1)])),_:2},1024)])),_:2},1024)):P("",!0),"auction"===t.type&&t.auctionEndTime&&r.isAuctionEnded(t)?($(),k(o,{key:4,class:"status-badge ended"},{default:I((()=>[T(i,null,{default:I((()=>[R("ğŸ”´ å·²çµæŸ")])),_:1})])),_:1})):P("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024),r.getCategoryDisplayName(t)?($(),k(o,{key:0,class:"category-tag-row"},{default:I((()=>[T(o,{class:"category-pill"},{default:I((()=>[T(i,null,{default:I((()=>[R("# "+x(r.getCategoryDisplayName(t)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)):P("",!0),T(o,{class:"card-content"},{default:I((()=>[T(i,{class:"post-title"},{default:I((()=>[R(x(t.title),1)])),_:2},1024),T(i,{class:"post-desc"},{default:I((()=>[R(x(t.content.substring(0,50))+"...",1)])),_:2},1024)])),_:2},1024),t.images&&t.images.length>0?($(),k(o,{key:1,class:"card-images"},{default:I((()=>[($(!0),F(D,null,N(t.images.slice(0,3),((t,e)=>($(),k(n,{key:e,src:t,mode:"aspectFill",class:"post-img"},null,8,["src"])))),128))])),_:2},1024)):t.image?($(),k(n,{key:2,src:t.image,mode:"aspectFill",class:"post-img-single"},null,8,["src"])):P("",!0),T(o,{class:"card-footer"},{default:I((()=>[T(o,{class:"interaction-stat"},{default:I((()=>[T(i,{class:"stat-icon"},{default:I((()=>[R("â¤ï¸")])),_:1}),T(i,{class:"stat-count"},{default:I((()=>[R(x(t.likes&&t.likes.length||0),1)])),_:2},1024)])),_:2},1024),T(o,{class:"interaction-stat"},{default:I((()=>[T(i,{class:"stat-icon"},{default:I((()=>[R("ğŸ’¬")])),_:1}),T(i,{class:"stat-count"},{default:I((()=>[R(x(t.comments&&t.comments.length||0),1)])),_:2},1024)])),_:2},1024),r.isFavorited(t.id)?($(),k(o,{key:0,class:"interaction-stat"},{default:I((()=>[T(i,{class:"stat-icon"},{default:I((()=>[R("â­")])),_:1}),T(i,{class:"stat-count"},{default:I((()=>[R("å·²æ”¶è—")])),_:1})])),_:1})):P("",!0)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),0===l.recentPosts.length?($(),k(o,{key:0,class:"empty-state"},{default:I((()=>[T(i,{class:"empty-icon"},{default:I((()=>[R("ğŸ“­")])),_:1}),T(i,{class:"empty-text"},{default:I((()=>[R("æš«ç„¡å¸–å­")])),_:1})])),_:1})):P("",!0)])),_:1})])),_:1}),T(d,{selectedBase:0})])),_:1})}],["__scopeId","data-v-fe7050b2"]]);export{U as default};
